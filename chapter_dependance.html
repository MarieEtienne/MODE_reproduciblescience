<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Companion book a M1 MODE student should have! - Chapter : statistical tests with dependent data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Companion book a M1 MODE student should have!</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MarieEtienne/MODE_reproduciblescience" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./prior_course.html" rel="" target="">
 <span class="menu-text">Before the class</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructions.html" rel="" target="">
 <span class="menu-text">Instructions</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-courses-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Courses Materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-courses-materials">    
        <li>
    <a class="dropdown-item" href="https://marieetienne.github.io/reproductibilite/_presentation/english_version.html" rel="" target="">
 <span class="dropdown-text">Git Intro</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-m1-mode-survival-book-by-the-m2-students" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">M1 MODE Survival book by the M2 students</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-m1-mode-survival-book-by-the-m2-students">    
        <li>
    <a class="dropdown-item" href="./AMV_chapter.html" rel="" target="">
 <span class="dropdown-text">Multivariate Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./linear_modelling.html" rel="" target="">
 <span class="dropdown-text">Linear modelling in ecology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Mixed_models.html" rel="" target="">
 <span class="dropdown-text">Mixed models in Ecology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./chapter_dependance.html" rel="" target="">
 <span class="dropdown-text">Dependent data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Matrix.html" rel="" target="">
 <span class="dropdown-text">Matrix models and applications in ecology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Chap_ODE.html" rel="" target="">
 <span class="dropdown-text">Ordinary Differential Equations in Ecology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r_chapter_boostrapping_resampling.html" rel="" target="">
 <span class="dropdown-text">Resampling methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bayesian_modeles.html" rel="" target="">
 <span class="dropdown-text">Bayesian models in Ecology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./simple_chapter.html" rel="" target="">
 <span class="dropdown-text">A simple chapter with no code</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-autocorrelation" id="toc-what-is-autocorrelation" class="nav-link" data-scroll-target="#what-is-autocorrelation">1. What is autocorrelation ?</a></li>
  <li><a href="#what-types-of-autocorrelation" id="toc-what-types-of-autocorrelation" class="nav-link" data-scroll-target="#what-types-of-autocorrelation">2. What types of autocorrelation ?</a></li>
  <li><a href="#why-is-this-important" id="toc-why-is-this-important" class="nav-link" data-scroll-target="#why-is-this-important">3. Why is this important?</a></li>
  </ul></li>
  <li><a href="#i.-time-dependence" id="toc-i.-time-dependence" class="nav-link" data-scroll-target="#i.-time-dependence">I. Time dependence</a>
  <ul class="collapse">
  <li><a href="#the-dataset" id="toc-the-dataset" class="nav-link" data-scroll-target="#the-dataset">1. The dataset</a></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">2. Data exploration</a></li>
  <li><a href="#autocorrelation" id="toc-autocorrelation" class="nav-link" data-scroll-target="#autocorrelation">3. Autocorrelation</a></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">4. Models</a></li>
  <li><a href="#medium-to-strong-time-dependency" id="toc-medium-to-strong-time-dependency" class="nav-link" data-scroll-target="#medium-to-strong-time-dependency">7. Medium to strong time dependency</a></li>
  <li><a href="#to-go-further" id="toc-to-go-further" class="nav-link" data-scroll-target="#to-go-further">8. To go further</a></li>
  </ul></li>
  <li><a href="#ii.-spatial-dependance" id="toc-ii.-spatial-dependance" class="nav-link" data-scroll-target="#ii.-spatial-dependance">II. Spatial dependance</a>
  <ul class="collapse">
  <li><a href="#codifying-the-neighbour-structure" id="toc-codifying-the-neighbour-structure" class="nav-link" data-scroll-target="#codifying-the-neighbour-structure"><strong>1 - Codifying the neighbour structure</strong></a>
  <ul class="collapse">
  <li><a href="#defining-neighbours" id="toc-defining-neighbours" class="nav-link" data-scroll-target="#defining-neighbours"><strong>1.1 Defining neighbours</strong></a></li>
  <li><a href="#connection-among-neighbours" id="toc-connection-among-neighbours" class="nav-link" data-scroll-target="#connection-among-neighbours"><strong>1.2 Connection among neighbours</strong></a></li>
  <li><a href="#neighborhood-weights" id="toc-neighborhood-weights" class="nav-link" data-scroll-target="#neighborhood-weights"><strong>1.3 Neighborhood weights</strong></a></li>
  </ul></li>
  <li><a href="#spatial-autocorrelation-indices" id="toc-spatial-autocorrelation-indices" class="nav-link" data-scroll-target="#spatial-autocorrelation-indices"><strong>2 - Spatial autocorrelation indices</strong></a>
  <ul class="collapse">
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation"><strong>2.1 Global measures of spatial autocorrelation</strong></a></li>
  <li><a href="#local-measures-of-spatial-autocorrelation" id="toc-local-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#local-measures-of-spatial-autocorrelation"><strong>2.2 Local measures of spatial autocorrelation</strong></a></li>
  <li><a href="#spatio-temporal-indices" id="toc-spatio-temporal-indices" class="nav-link" data-scroll-target="#spatio-temporal-indices"><strong>2.3 Spatio-temporal indices</strong></a></li>
  </ul></li>
  <li><a href="#spatial-modeling" id="toc-spatial-modeling" class="nav-link" data-scroll-target="#spatial-modeling">3 - Spatial modeling</a>
  <ul class="collapse">
  <li><a href="#stationary-process-1" id="toc-stationary-process-1" class="nav-link" data-scroll-target="#stationary-process-1">3.1.Stationary process</a></li>
  <li><a href="#non-stationary-process-1" id="toc-non-stationary-process-1" class="nav-link" data-scroll-target="#non-stationary-process-1">3.2. - Non stationary process</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter : statistical tests with dependent data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="what-is-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="what-is-autocorrelation">1. What is autocorrelation ?</h3>
<p>Statistical analyses, including many regression methods, often assume that observations are independent of each other. Most of the time, it seems natural to analyse two different datas, X and Y, assuming their independence. But there may still be a dependency intrinsic to each of them: this is known as autocorrelation. Autocorrelation indicates that the independence assumption is not satisfied, which can lead to biased parameter estimates, incorrect confidence intervals and a loss of statistical power.</p>
<p>In statistics, autocorrelation is a measure of the linear dependence between the values of one variable itself, at different times or locations. Checking for autocorrelation in a variable means analyzing the relationship between an observation and other previous observations in the series. In other words, this means analyzing the possible link between what is measured at time 1 and what is measured at time 2, to see if the data at time 2 can be predicted with what we know about the data at time 1, if they are close in space or time.</p>
<p>Correlation between two observations is often expressed as a correlation coefficient, such as Pearson’s correlation coefficient. Values are correlated with an offset function in time or space, giving an autocorrelation coefficient which may be:</p>
<ul>
<li><p>positive: indicating that the observations tend to be similar,</p></li>
<li><p>negative: indicating that the observations tend to be opposite to each other.</p></li>
</ul>
</section>
<section id="what-types-of-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="what-types-of-autocorrelation">2. What types of autocorrelation ?</h3>
<p>Autocorrelation is commonly used to analyze data for which the order or location of observations has an important significance, such as:</p>
<ul>
<li><p>Time series: data taken at the same location at several points in time,</p></li>
<li><p>Spatial data: data taken at a given point in time at several locations in the same geographical area, and therefore close in space.</p></li>
</ul>
<section id="time-series" class="level4">
<h4 class="anchored" data-anchor-id="time-series">2.1. Time series</h4>
<p>A typical example of autocorrelation in a time series is a seasonal autocorrelation, where values are observed at a same time each year (seasons), and are therefore correlated with each other.</p>
<p>Temporal autocorrelation shows spatial similarities that depend on the scale used.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Intro_dependance.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>(from P. LeGouar)</strong></figcaption>
</figure>
</div>
<p>Temporal autocorrelation in ecology is important for understanding the processes of reproduction, migration, population dispersal and species responses to seasonal environmental changes.</p>
<section id="example-of-temporal-autocorrelation" class="level5">
<h5 class="anchored" data-anchor-id="example-of-temporal-autocorrelation">Example of temporal autocorrelation</h5>
<p>An example of temporal autocorrelation in ecology concerns populations of animal or plant species, particularly when studying seasonal variations. Let’s imagine a study of annual fluctuations in the population of migratory birds in a given region. Temporal autocorrelation means that the number of birds observed at a given time of the year is correlated with the number of birds observed at the same time of the previous year.</p>
<p>Suppose the data show positive temporal autocorrelation for a migratory bird species. This would mean that if, for example, in April of the current year, a large number of these birds are observed, it is highly likely that in April of the previous year, a large number of these same birds were also observed. This temporal dependence may be due to seasonal bird migrations, the availability of food resources or other cyclical environmental factors.</p>
</section>
</section>
<section id="spatial-dependence" class="level4">
<h4 class="anchored" data-anchor-id="spatial-dependence">2.2. Spatial dependence</h4>
<p>Spatial autocorrelation refers to the correlation between observations in close spatial locations. It shows temporal similarities that depend on the scale used. Spatial autocorrelation is important for understanding patterns of species distribution, population dispersal, biotic interactions and ecological processes at different spatial scales.</p>
<p>Spatial autocorrelation can be due to various factors, such as :</p>
<ul>
<li><p>Microclimate effects: local characteristics of terrain, vegetation or topography can influence temperature on a small scale,</p></li>
<li><p>Dispersion phenomena: the propagation of heat, wind, humidity or other environmental factors can cause spatial autocorrelation,</p></li>
<li><p>Biotic interactions: interactions between plant, animal and micro-organism species in an ecosystem can also influence the spatial distribution of variables such as temperature.</p></li>
</ul>
<section id="example-of-spatial-dependence" class="level5">
<h5 class="anchored" data-anchor-id="example-of-spatial-dependence">Example of spatial dependence</h5>
<p>An example of spatial autocorrelation is the observation of temperature distribution in a large forest. Let’s imagine a large, dense forest with many weather stations measuring temperatures at different locations. Spatial autocorrelation would manifest itself in the fact that temperatures recorded at nearby locations in the forest are correlated, i.e.&nbsp;they tend to be similar.</p>
<p>Suppose the data show positive spatial autocorrelation. This would mean that, if you have two weather stations located close to each other (say, a few meters apart), the temperatures measured at these two stations at any given time are highly positively correlated. In other words, when one of the stations records a high temperature, the other station will also tend to record a high temperature, and vice versa.</p>
</section>
</section>
</section>
<section id="why-is-this-important" class="level3">
<h3 class="anchored" data-anchor-id="why-is-this-important">3. Why is this important?</h3>
<p>Autocorrelation is an essential concept in statistics, as it can have a significant impact on data analysis. In the presence of pseudoreplications, meaning that several different values are thought to be taken when in fact they are dependent on each other, it may appear that one variable has a significant effect on another, when in reality this effect is biased due to the temporal or spatial dependence of the data. It can therefore have a significant impact on statistical analysis, and often requires adjustments to ensure that results are reliable and unbiased.</p>
<p>Autocorrelation checking is an essential process in statistics to guarantee the accuracy, reliability and validity of analyses. It enables appropriate statistical methods to be applied, biases to be corrected and informed modeling and forecasting decisions to be made. It is also essential for understanding patterns of variation in biological data.</p>
<p><br></p>
</section>
</section>
<section id="i.-time-dependence" class="level1">
<h1>I. Time dependence</h1>
<p>Temporal dependency means that values sampled at a given time can be related to the value sampled before. Therefore, the variable can be correlated to itself and create <strong>pseudoreplication</strong>.</p>
<p>Diverse packages on R are useful to manage time series, such as TSA (Time Series Analysis).</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'TSA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    spec</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    acf, arima</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:utils':

    tar</code></pre>
</div>
</div>
<section id="the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="the-dataset">1. The dataset</h3>
<p>To understand better how to handle time series, data are used to illustrate the process from an experiment on vultures in time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dataT<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"vautour.txt"</span>,<span class="at">header=</span>T,<span class="at">dec=</span><span class="st">","</span>, <span class="at">stringsAsFactors =</span> T)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataT)       <span class="co"># What are the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  col year   success    growth  denstot     ratio
1   C 1985 0.5000000 1.2500000  9.00000 0.1432580
2   C 1986 0.5000000 0.6666667  4.00000 0.4604144
3   C 1987 0.8333333 1.3750000 17.00000 0.7876576
4   C 1988 0.5238095 1.2000000 29.00000 0.6261380
5   C 1989 0.5000000 1.1428571 45.00000 0.3209719
6   C 1990 0.5694444 1.1296296 27.33333 0.2768327</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dataT)    <span class="co"># Summary of the spread of each variable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> col         year         success           growth          denstot      
 C:19   Min.   :1972   Min.   :0.3333   Min.   :0.6667   Min.   : 4.000  
 O:27   1st Qu.:1983   1st Qu.:0.5964   1st Qu.:1.0055   1st Qu.: 9.167  
        Median :1990   Median :0.7197   Median :1.1329   Median :26.833  
        Mean   :1989   Mean   :0.7268   Mean   :1.1172   Mean   :28.023  
        3rd Qu.:1995   3rd Qu.:0.8735   3rd Qu.:1.1982   3rd Qu.:41.643  
        Max.   :2003   Max.   :1.0000   Max.   :1.3889   Max.   :68.933  
     ratio         
 Min.   :0.007996  
 1st Qu.:0.207050  
 Median :0.420548  
 Mean   :0.464461  
 3rd Qu.:0.733536  
 Max.   :0.993844  </code></pre>
</div>
</div>
<p>Two colonies ‘C’ and ‘O’ are studied from 1972 to 2003. In particular, the reproductive success (success), the growth rate (growth), the density of population (denstot) and the resource availability (ratio) of the colonies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Arrange the dataset</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dataT_ordered<span class="ot">=</span>dataT <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(col,year)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Create 2 sub-datasets for the 2 colonies</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span>dataT[dataT<span class="sc">$</span>col<span class="sc">==</span><span class="st">"C"</span>,]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>O<span class="ot">=</span>dataT[dataT<span class="sc">$</span>col<span class="sc">==</span><span class="st">"O"</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-exploration" class="level3">
<h3 class="anchored" data-anchor-id="data-exploration">2. Data exploration</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Data representation</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Window size</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="fl">2.5</span>,<span class="dv">0</span>),<span class="at">oma=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>)) </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Colony C</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(C[,<span class="dv">2</span>],C[,<span class="dv">3</span>], <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"mean reproductive success"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(C[,<span class="dv">2</span>],C[,<span class="dv">3</span>])</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(C[,<span class="dv">2</span>],C[,<span class="dv">4</span>], <span class="at">pch=</span><span class="dv">17</span>, <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"Colony growth rate"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(C[,<span class="dv">2</span>],C[,<span class="dv">4</span>])</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(C[,<span class="dv">2</span>],C[,<span class="dv">5</span>],<span class="at">pch=</span><span class="dv">16</span>, <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"Number of pairs"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(C[,<span class="dv">2</span>],C[,<span class="dv">5</span>])</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">text=</span><span class="st">"Parameter for Colony C"</span>,<span class="at">side=</span><span class="dv">3</span>,<span class="at">line=</span><span class="sc">-</span><span class="dv">1</span>,<span class="at">outer=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Colony O</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(O[,<span class="dv">2</span>],O[,<span class="dv">3</span>],  <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"mean reproductive success"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(O[,<span class="dv">2</span>],O[,<span class="dv">3</span>])</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(O[,<span class="dv">2</span>],O[,<span class="dv">4</span>],<span class="at">pch=</span><span class="dv">17</span>, <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"Colony growth rate"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(O[,<span class="dv">2</span>],O[,<span class="dv">4</span>])</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(O[,<span class="dv">2</span>],O[,<span class="dv">5</span>], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">xlab=</span><span class="st">"year"</span>, <span class="at">ylab=</span><span class="st">"Number of pairs"</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(O[,<span class="dv">2</span>],O[,<span class="dv">5</span>])</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">text=</span><span class="st">"Parameter for Colony O"</span>,<span class="at">side=</span><span class="dv">1</span>,<span class="at">line=</span><span class="sc">-</span><span class="fl">14.5</span>,<span class="at">outer=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Through time, all the variables do not have the same behaviour for both of the colonies. Some variables fluctuate in time like the O colony growth rate, or can evolve gradually, like the number of pairs for the O colony.</p>
<p>The irregularity in time of the variables can mean that the data are correlated to the precedent ones. A key parameter to know if there really is a correlation of the variable to itself is <strong>autocorrelation</strong>.</p>
</section>
<section id="autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="autocorrelation">3. Autocorrelation</h3>
<p>Autocorrelation is given by the expression: <span class="math display">\[\rho(k) = \frac{E(X_tX_{t+1}) - E(X_t)E(X{t+1})}{\sqrt{E(X_t^2)E(X_{t+1}^2)}}\]</span></p>
<p>With the discrete sequence <span class="math inline">\(\{X_1, ... X_T\}\)</span> with <span class="math inline">\(X = \{X_t\}_{t\in\mathbb{N}}\)</span> as <span class="math inline">\(E[X_t^2] &lt; \infty\)</span> for <span class="math inline">\(t\in\mathbb{Z}\)</span>.</p>
<p>In other words, the values are compared to their neighbors to conclude if they are correlated or not.</p>
<p>The autocorrelation can be detected in a <strong>non-stationary process</strong>.</p>
<p><strong>Stationnarity</strong> is the constistency of the statistical parameters of a series such as the mean and the variance (Figure).</p>
<ul>
<li>In non-stationary processes, these parameters vary in time.</li>
<li>In stationary processes, the values gravitate around a mean value within the same range.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="C:/Users%5CUser%5COneDrive%5CBureau%5CMODE%5CM2%5COCR%5CStationarycomparison.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Stationary and non-stationary processes</figcaption>
</figure>
</div>
<p>Given the precedent plots displayed, one would think there are both stationary and non-stationary processes within the different variables. Tests will allow us to know with more details if there is a dependency.</p>
<p>On R, autocorrelation can be known thanks to the function acf (Auto- and Cross- Covariance and -Correlation Function Estimation) of the TSA package.</p>
<p><strong>Important note:</strong> In order for the acf() function to work, the data have to be sorted according to time with one value per time step. To do so, <em>NA</em> or mean values can be added if necessary to fill the dataset accordingly. The package lubridate can be useful to manage dates data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(C[,<span class="dv">3</span>], <span class="at">main=</span><span class="st">"Reproductive success for C"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(C[,<span class="dv">4</span>], <span class="at">main=</span><span class="st">"Growth rate for C"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(C[,<span class="dv">5</span>], <span class="at">main=</span><span class="st">"Density for C"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(O[,<span class="dv">3</span>], <span class="at">main=</span><span class="st">"Reproductive success for O"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(O[,<span class="dv">4</span>], <span class="at">main=</span><span class="st">"Growth rate for O"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(O[,<span class="dv">5</span>], <span class="at">main=</span><span class="st">"Density for O"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plots display the correlation coefficient at the associated time step with the neighbors (lag). The blue dotted lines represent the significance threshold of correlation.</p>
<p>These plots allow us to know if the time dependency exists and what profile it follows.</p>
<ul>
<li>Growth rate of O and reproductive success of C : <strong>White noise</strong>. There is no significant value and particular pattern. Therefore, no time dependency.</li>
<li>Density of C and reproductive success of O : <strong>Short positive dependency</strong>. Some values are significantly positively correlated and a pattern emerges (cyclic here).</li>
<li>Growth rate of C : <strong>Short negative dependency</strong>. Some values are significantly negatively correlated and a pattern emerges (cyclic here).</li>
<li>Density of O : <strong>Long term dependency</strong>. Several values are significantly correlated and a pattern appears (linear here).</li>
</ul>
<p>For the following analyses, we will focus on the Density of the O colony. The time is considered an <strong>autocovariable</strong>.</p>
</section>
<section id="models" class="level3">
<h3 class="anchored" data-anchor-id="models">4. Models</h3>
<p>Now that the time dependency have been proved to be true thanks to autocorrelation test, it is possible to proceed with adapted statistical tests.</p>
<p>Different models can be used according to the type of dependency found in the data. The goal will be to apply the model and verify that there is no time dependency left on the <strong>residuals</strong>.</p>
<section id="least-square-ordinary-regression" class="level4">
<h4 class="anchored" data-anchor-id="least-square-ordinary-regression">5. Least square ordinary regression</h4>
<p>Least square ordinary regression methods are used during the process of selection of the model.</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1X_1 + \beta_2X_2+...+\beta_nX_n + \epsilon\]</span> - <span class="math inline">\(Y\)</span> is the dependent variable - <span class="math inline">\(X_n\)</span> are the explanatory variables - <span class="math inline">\(\beta_n\)</span> are the coefficients of <span class="math inline">\(X\)</span> - <span class="math inline">\(\epsilon\)</span> is the random error term or <strong>residuals</strong></p>
<p>To select a relevant model is the same as selecting a model that maximizes <strong>likelihood</strong> and minimize the <strong>number of parameters</strong>.</p>
</section>
<section id="weak-time-dependency" class="level4">
<h4 class="anchored" data-anchor-id="weak-time-dependency">6. Weak time dependency</h4>
<p>If the data display a weak time dependency, it is possible to simply add the time as a random variable to the model.</p>
<p><span class="math display">\[Y\sim\alpha.X + time\]</span></p>
<p><strong>Important note:</strong> If the variance of <span class="math inline">\(Y\)</span> increases beforehand, you will need to perform a <strong>logarithmic</strong> transformation. If the variance of <span class="math inline">\(Y\)</span> decreases beforehand, one would use an <strong>exponential</strong> transformation. Here, the variance increases.</p>
<p>A useful package on R to manage glm and gls is be nlme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(O<span class="sc">$</span>denstot, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Histogram of total density"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> ,<span class="st">"of O colony "</span>), <span class="at">xlab =</span> <span class="st">"Density"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(O<span class="sc">$</span>denstot), <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Histogram of total density"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> ,<span class="st">"of colony O (log transformation)"</span>), <span class="at">xlab =</span> <span class="st">"Log(Density)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plots indicates that a log transformation could help better manage the data.</p>
<p>A simple lme model can be used (Linear Mixed-Effects Model) with X = log(total density) and Y the ressource availability.</p>
<p>We can check if the model is satisfactory if the residuals are not significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model construction</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>modlme<span class="ot">=</span><span class="fu">lme</span>(<span class="fu">log</span>(denstot) <span class="sc">~</span> ratio, <span class="at">data=</span>O, <span class="at">random=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>year) </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(modlme<span class="sc">$</span>residuals[,<span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Residuals of the lme model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by REML
  Data: O 
       AIC      BIC    logLik
  81.15956 86.03506 -36.57978

Random effects:
 Formula: ~1 | year
        (Intercept)  Residual
StdDev:    0.896558 0.3362093

Fixed effects:  log(denstot) ~ ratio 
               Value Std.Error DF  t-value p-value
(Intercept) 2.177414 0.3189390 25 6.827055  0.0000
ratio       1.345590 0.5560464 25 2.419925  0.0231
 Correlation: 
      (Intr)
ratio -0.816

Standardized Within-Group Residuals:
          Min            Q1           Med            Q3           Max 
-0.6631737487 -0.2783018429 -0.0002989742  0.2288493092  0.6403315530 

Number of Observations: 27
Number of Groups: 27 </code></pre>
</div>
</div>
<p>The plot shows there is still a time dependency in this kind of model. The correlation value is too strong, the model is not adapted to this case.</p>
</section>
</section>
<section id="medium-to-strong-time-dependency" class="level3">
<h3 class="anchored" data-anchor-id="medium-to-strong-time-dependency">7. Medium to strong time dependency</h3>
<p>If a medium or a strong time dependency are proven, adding time as a random effect will not be effective enough. It will be necessary to use <strong>Time Models</strong>.</p>
<section id="stationary-process" class="level4">
<h4 class="anchored" data-anchor-id="stationary-process">7.1 Stationary process</h4>
<p>To deal with stationary processes, it is possible to use GLS (Generalized Leat Square) models. Three major GLS models can be used.</p>
<ul>
<li><p><strong>AR</strong> or <strong>Autoregressive Model</strong> states that a value <span class="math inline">\(Y_{(t)}\)</span> will depend on the values <span class="math inline">\(Y\)</span> at <span class="math inline">\(p\)</span> the precedent times. The model adds a an autoregressive coefficient <span class="math inline">\(\phi_p\)</span> to each <span class="math inline">\(Y_{(t-1)}\)</span> value. In summary, this model explains the current value as a linear combination of the precedent values with <span class="math inline">\(\epsilon_t\)</span> the random component or white noise. <span class="math display">\[Y_{(t)}=\mu+\phi_1 \times Y_{(t-1)}+\phi_2 \times Y_{(t-2)} + ...+\phi_q \times Y_{(t-p)}+\epsilon_{(t)}\]</span></p></li>
<li><p><strong>MA</strong> or <strong>Moving Average model</strong> functions in the same way as the AR model. However, it will consider that the current value of a series is the weighted linear combination of the previous <span class="math inline">\(q\)</span> errors.</p></li>
</ul>
<p><span class="math display">\[Y_{(t)}= \mu+ \theta_1 \times \epsilon_{(t-1)}+\theta_2 \times \epsilon_{(t-2)}) + ...+\theta_q \times \epsilon_{(t-q)} \]</span></p>
<ul>
<li><strong>ARMA</strong> is a combination of <strong>AR</strong> and <strong>MA</strong> models and is a linear combination of the <span class="math inline">\(p\)</span> past values and <span class="math inline">\(q\)</span> past residual errors.</li>
</ul>
<p><span class="math display">\[Y_{(t)}=\mu+\phi_1 \times Y_{(t-1)}+\phi_2 \times Y_{(t-2)} + ...+\phi_q \times Y_{(t-p)}+\epsilon_{(t)} + \theta_1 \times \epsilon_{(t-1)}+\theta_2 \times \epsilon_{(t-2)}) + ...+\theta_q \times \epsilon_{(t-q)} \]</span> The gls() function covers the three types of model depending on the correlation structure of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model construction</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>modgls<span class="ot">=</span><span class="fu">gls</span>(<span class="fu">log</span>(denstot) <span class="sc">~</span>  year <span class="sc">+</span> ratio, <span class="at">data=</span>O, <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">value=</span><span class="fl">0.9</span>,<span class="at">form =</span> <span class="sc">~</span> year))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(modgls<span class="sc">$</span>residuals, <span class="at">main =</span> <span class="st">"Residuals of the gls model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modgls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by REML
  Model: log(denstot) ~ year + ratio 
  Data: O 
       AIC      BIC    logLik
  15.67389 21.56415 -2.836943

Correlation Structure: AR(1)
 Formula: ~year 
 Parameter estimate(s):
      Phi 
0.7161672 

Coefficients:
                 Value Std.Error   t-value p-value
(Intercept) -236.27349 30.847312 -7.659451  0.0000
year           0.12045  0.015544  7.748987  0.0000
ratio         -0.02149  0.106990 -0.200826  0.8425

 Correlation: 
      (Intr) year  
year  -1.000       
ratio  0.142 -0.143

Standardized residuals:
       Min         Q1        Med         Q3        Max 
-2.1682662 -0.4112077  0.1065081  0.7340184  1.0718461 

Residual standard error: 0.3264013 
Degrees of freedom: 27 total; 24 residual</code></pre>
</div>
</div>
<p>The autoregressive coefficient Psi is equal to 0.72. The autocorrelation is not completely removed. Still, the variable ‘ratio’ does not have a significant effect on <span class="math inline">\(Y\)</span> anymore.</p>
<p>We can compare the two previous models thanks to an analysis of their variance (anova).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modgls,modlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nlme::anova.lme(object = modgls, modlme): fitted objects with
different fixed effects. REML comparisons are not meaningful.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       Model df      AIC      BIC    logLik   Test  L.Ratio p-value
modgls     1  5 15.67389 21.56415  -2.83694                        
modlme     2  4 81.15956 86.03506 -36.57978 1 vs 2 67.48567  &lt;.0001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modgls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: log(denstot)
      Df   Chisq Pr(&gt;Chisq)    
year   1 60.0468  9.263e-15 ***
ratio  1  0.0403     0.8408    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(modlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table (Type II tests)

Response: log(denstot)
      Chisq Df Pr(&gt;Chisq)  
ratio 5.856  1    0.01552 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>modgls2<span class="ot">=</span><span class="fu">gls</span>(<span class="fu">log</span>(denstot) <span class="sc">~</span>   ratio, O, <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">value=</span><span class="fl">0.9</span>,<span class="at">form =</span> <span class="sc">~</span> year))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modgls2,modlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Model df      AIC      BIC    logLik
modgls2     1  4 15.21587 20.09137  -3.60793
modlme      2  4 81.15956 86.03506 -36.57978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modgls2,modgls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in nlme::anova.lme(object = modgls2, modgls): fitted objects with
different fixed effects. REML comparisons are not meaningful.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        Model df      AIC      BIC    logLik   Test  L.Ratio p-value
modgls2     1  4 15.21587 20.09137 -3.607935                        
modgls      2  5 15.67389 21.56415 -2.836943 1 vs 2 1.541984  0.2143</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modgls2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Denom. DF: 25 
            numDF     F-value p-value
(Intercept)     1 0.000000006  0.9999
ratio           1 0.014065502  0.9065</code></pre>
</div>
</div>
<p>The second models fits the data better than the first. We can conclude that the autocorrelation made the ratio variable effect wrongly significant.</p>
<p>In order to chose the range of application of the parameters <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>, it is possible to use a <strong>partial correlation function</strong> that will display the direct correlation link between the time steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">log</span>(O<span class="sc">$</span>denstot), <span class="at">main=</span><span class="st">"Density for O"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(<span class="fu">log</span>(O<span class="sc">$</span>denstot), <span class="at">main=</span><span class="st">"Density for O"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So, the order <span class="math inline">\(p\)</span> (AR) is generally chosen based on significant lags in the PACF, and the order <span class="math inline">\(q\)</span> (MA) is generally chosen based on significant lags in the ACF.</p>
</section>
<section id="non-stationary-process" class="level4">
<h4 class="anchored" data-anchor-id="non-stationary-process">7.2 Non-stationary process</h4>
<p>To manage non-stationary processes, another model called <strong>ARIMA</strong> is used. A new parameter <span class="math inline">\(d\)</span> is introduced with <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>.</p>
<p><strong>ARIMA(p,d,q)</strong> models are a combination of <strong>AR</strong> models with <span class="math inline">\(p\)</span>, <strong>MA</strong> models with <span class="math inline">\(q\)</span>, and finally includes difference of order <span class="math inline">\(d\)</span>.</p>
<p>This difference helps make the series stationary by subtracting from the current value the values from the previous <span class="math inline">\(d\)</span> time points.</p>
<p>In general, we will choose an order <span class="math inline">\(d=1\)</span> when the series shows a <strong>constant trend</strong>, and an order <span class="math inline">\(d=2\)</span> when the series shows a <strong>fluctuating trend</strong>.</p>
<p>On R, ARIMA models can be used with the function arima(). The argument ’order’contains the values of <span class="math inline">\(p\)</span>, <span class="math inline">\(d\)</span> and <span class="math inline">\(q\)</span>, in that order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>arima1<span class="ot">=</span>stats<span class="sc">::</span><span class="fu">arima</span>(<span class="fu">log</span>(O<span class="sc">$</span>denstot),<span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">xreg=</span>O<span class="sc">$</span>ratio)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>arima1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stats::arima(x = log(O$denstot), order = c(1, 1, 1), xreg = O$ratio)

Coefficients:
         ar1     ma1  O$ratio
      0.1244  0.0987  -0.0038
s.e.  0.5483  0.5314   0.0905

sigma^2 estimated as 0.06632:  log likelihood = -1.65,  aic = 11.29</code></pre>
</div>
</div>
<p>Different values of these parameters can be tested to find the best model with the AIC criteria displayed in the results. <span class="math inline">\(d\)</span> must always be equal to 1.</p>
<p>The ARIMA function can help make <strong>predictions</strong>.</p>
<ul>
<li>prediction: now we will use this statistical model to make prediction under a specific scenario</li>
<li>scenario: constant and maximum availability in resource (ratio=1) during 20 years</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>newxreg<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">O.ratio=</span><span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">20</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(arima1, <span class="at">n.ahead =</span> <span class="dv">20</span>,newxreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 28 
End = 47 
Frequency = 1 
 [1] 4.241140 4.242138 4.242262 4.242277 4.242279 4.242280 4.242280 4.242280
 [9] 4.242280 4.242280 4.242280 4.242280 4.242280 4.242280 4.242280 4.242280
[17] 4.242280 4.242280 4.242280 4.242280

$se
Time Series:
Start = 28 
End = 47 
Frequency = 1 
 [1] 0.2575288 0.4068621 0.5189478 0.6112697 0.6914231 0.7632103 0.8288035
 [8] 0.8895733 0.9464492 1.0000958 1.0510076 1.0995646 1.1460662 1.1907532
[15] 1.2338228 1.2754388 1.3157392 1.3548413 1.3928461 1.4298412</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pred<span class="ot">=</span><span class="fu">predict</span>(arima1, <span class="at">n.ahead =</span> <span class="dv">20</span>,newxreg)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>obspred<span class="ot">=</span><span class="fu">rbind</span> (<span class="fu">data.frame</span>(<span class="at">denstot=</span>O<span class="sc">$</span>denstot), <span class="fu">data.frame</span>(<span class="at">denstot=</span><span class="fu">exp</span>(<span class="fu">predict</span>(arima1, <span class="at">n.ahead =</span> <span class="dv">20</span>,newxreg)<span class="sc">$</span>pred)))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(obspred<span class="sc">$</span>denstot, <span class="at">main =</span> <span class="st">"Prediction on a 20 years scenario"</span>, <span class="at">ylab =</span><span class="st">"Predicted observations for the total density of O"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(obspred<span class="sc">$</span>denstot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="to-go-further" class="level3">
<h3 class="anchored" data-anchor-id="to-go-further">8. To go further</h3>
<p>The <strong>ARIMAX</strong> model, which stands for <strong>AutoRegressive Integrated Moving Average with eXogenous inputs</strong>, is an extension of the ARIMA model that incorporates additional exogenous (external) variables. The ARIMAX model is particularly useful when there are external factors that can influence the time series to model.</p>
<p>The eXogenous (X) Inputs are additional external variables that are not part of the time series being modeled but may influence it. These variables are included in the model to capture their impact on the dependent variable.</p>
<p>The ARIMAX model allows to account for the influence of external factors when modeling time series data, making it more flexible and potentially improving the accuracy of predictions.</p>
</section>
</section>
<section id="ii.-spatial-dependance" class="level1">
<h1>II. Spatial dependance</h1>
<p>Spatial relationships are multidirectional and multilateral. They are distinct, in this sense, from temporal relationships, which allow only sequential relationships along the past-present-future axis.</p>
<p>These are the steps that will be followed here :</p>
<p><strong>Define connection criteria</strong>: We establish criteria for connections, determining that point A is connected to point B, which in turn is connected to point C, and so forth. This linkage needs to be translated into a numerical value, providing a quantitative measure of connectivity.</p>
<p><strong>Transform information into numerical value:</strong> The established connection criteria are converted into numerical values, creating a quantifiable representation of the relationships between points. This numerical transformation is crucial for subsequent analyses.</p>
<p><strong>Calculate autocorrelation coefficient:</strong> Utilizing the numerical values derived from the connection criteria, we compute an autocorrelation coefficient. This statistical measure helps quantify the degree of spatial autocorrelation, providing insights into the patterns of similarity or dissimilarity among neighbouring points.</p>
<p><strong>Integrating spatial autocorrelation into analyses:</strong> Upon detecting spatial autocorrelation, the next step involves seamlessly integrating this information into our analytical processes. This will be discussed later in this chapter.</p>
<hr>
<section id="codifying-the-neighbour-structure" class="level2">
<h2 class="anchored" data-anchor-id="codifying-the-neighbour-structure"><strong>1 - Codifying the neighbour structure</strong></h2>
<hr>
<section id="defining-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="defining-neighbours"><strong>1.1 Defining neighbours</strong></h3>
<section id="characteristics-of-the-relationships-between-spatial-objects" class="level4">
<h4 class="anchored" data-anchor-id="characteristics-of-the-relationships-between-spatial-objects"><strong>1.1.1 Characteristics of the relationships between spatial objects</strong></h4>
<p>Consider a surface ℜ. This surface can be divided into n mutually exclusive zones. Two adjacent zones are separated by a common boundary.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mathematical definition of spatial relationships
</div>
</div>
<div class="callout-body-container callout-body">
<p>Spatial relationships <span class="math inline">\(B\)</span> are a subset of the Cartesian product <span class="math inline">\(ℝ²× ℝ² = {(i, j) : i ∈ ℝ ², j ∈ ℝ²}\)</span> of couples <span class="math inline">\((i, j)\)</span> of spatial objects, i.e.&nbsp;all couples <span class="math inline">\((i, j)\)</span> such that <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> are both spatial objects identified by their geographical coordinates, and such that <span class="math inline">\((i, j)\)</span> is different from <span class="math inline">\((j,i)\)</span>. A spatial object cannot be linked to itself: <span class="math inline">\((i,i) ⊈ B\)</span>. Moreover, if <span class="math inline">\((i, j) ⊆ B\)</span> and <span class="math inline">\((j,i) ⊆ B\)</span> for all couples of spatial objects, the spatial relationships are said to be symmetrical (Tiefelsdorf, 1998).</p>
</div>
</div>
<p><em>Figure 2.1</em> illustrates the codifying process of spatial relationships. This approach makes it possible to systematically transcribe the complexity of geographic space into a final set of data analyzable by a computer.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1363470329.png" class="img-fluid figure-img" width="517"></p>
<figcaption class="figure-caption"><strong>Figure 2.1 :</strong> Codifying spatial correlation (Tiefelsdorf, 1998)</figcaption>
</figure>
</div>
<p>First, the study zone is divided into mutually exclusive areas. Each area contains a reference point (often its centroid). Then, the spatial relationships can be specified by a neighbourhood graph connecting the areas considered to be neighbouring, or by a matrix containing the geographical coordinates of the reference points. The third step consists in coding the graph in a neighbourhood matrix, or transforming the geographic coordinates into a distance matrix.</p>
<p>The neighborhood matrix measures the similarity between observations. A value greater than zero indicates that the observations are considered neighbors. For example, in the case of the binary matrix shown in figure 1 :</p>
<p><img src="image-232123009.png" width="470" height="59"></p>
<p>Conversely, the distance matrix measures dissimilarity between zones. The higher <span class="math inline">\(d_{ij}\)</span> , the more different the zones. With, if an Euclidian distance is used : <span class="math inline">\(d_{ij}=\sqrt{(x_i-x_j )^2+(y_i-y_j )²}\)</span>, <span class="math inline">\(α\)</span> and <span class="math inline">\(β\)</span> being the geographical coordinates of the observations. The spatial dependence structure may not be geographical. Any relevant dual relationship may be used to define a neighbourhood graph. For instance:</p>
<ul>
<li>Genetic proximity between families</li>
<li>Cultural exchanges</li>
<li>Migratory flows</li>
</ul>
</section>
<section id="the-list-of-neighbours-object-in-r" class="level4">
<h4 class="anchored" data-anchor-id="the-list-of-neighbours-object-in-r"><strong>1.1.2 The “list of neighbours” object in R</strong></h4>
<p>Package <em>spdep</em> makes it possible to define the relationships between spatial objects. In R, the class of an object defines all its properties and how the statistician can use it. Neighbourhood relationships are recorded in an object of class nb. Assume n spatial observations and <code>neighbours_nb</code> the spatial object containing the associated neighbourhood relationships. <code>neighbours_nb</code> is a list of length n.&nbsp;Each element <code>[i]</code> of the list contains a vector with the index of the neighbours of the item indexed i. If <code>[i]</code> does not have neighbours, the list contains only 0. The list also contains a vector of characters corresponding to the attributes of each neighbourhood zone, as well as a logical value indicating whether the relationship is symmetrical. The main information about the object <code>neighbours_nb</code> can be derived using the function: <code>summary(neighbours_nb)</code></p>
<p>Let’s load a few packages useful for analysis :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Spatial series analysis : packages</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Libraries for spatial series analyses</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep) <span class="co">#to extracted the neighbors is a spatial data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spdep'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ade4':

    mstree</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ade4)  <span class="co">#used for plotting spatial data</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg) <span class="co">#used for spatial data modelling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spatialreg'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:spdep':

    get.ClusterOption, get.coresOption, get.mcOption,
    get.VerboseOption, get.ZeroPolicyOption, set.ClusterOption,
    set.coresOption, set.mcOption, set.VerboseOption,
    set.ZeroPolicyOption</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gwrr)  <span class="co">#to run geographically weighted regression</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: fields</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spam</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Spam version 2.10-0 (2023-10-23) is loaded.
Type 'help( Spam)' or 'demo( spam)' for a short introduction 
and overview of this package.
Help for individual functions is also obtained by adding the
suffix '.spam' to the function name, e.g. 'help( chol.spam)'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spam'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:Matrix':

    det</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    backsolve, forwardsolve</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Try help(fields) to get started.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lars</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded lars 1.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#these two libraries (spdep and ade4 also provive function that make object compatibles between library)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s then begin the analysis of a first dataset dealing with richness of birds from agricultural habitats and of plant species from permanent pastures at the scale of Ille-et-Vilaine, “<em>div35</em>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset div35</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#For a REGULAR configuration of points </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#      0 - Exploring the dataset </span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Investigate the data set of plant and bird richness at the scale of Ille-et-Vilaine</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Import dataset</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>div35<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"div35.txt"</span>, <span class="at">header=</span>T, <span class="at">dec=</span><span class="st">","</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(div35)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    rich_pp         rich_ois           x                y          
 Min.   :14.00   Min.   :13.00   Min.   :555000   Min.   :5285000  
 1st Qu.:23.00   1st Qu.:32.00   1st Qu.:575000   1st Qu.:5315000  
 Median :25.00   Median :34.00   Median :595000   Median :5335000  
 Mean   :24.51   Mean   :33.74   Mean   :593971   Mean   :5336029  
 3rd Qu.:26.00   3rd Qu.:37.00   3rd Qu.:615000   3rd Qu.:5355000  
 Max.   :29.00   Max.   :41.00   Max.   :635000   Max.   :5385000  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the spatial distribution of the points</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(div35[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is a map of Ille-et-Vilaine department.</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#We can point St-Malo in the North and Rennes in the center for of the map, for example.</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#The spatial configuration of the points is regular.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also start the analysis of second dataset dealing with chemical measures in a set of ponds, “<em>mares</em>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset mares</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#For an IRREGULAR configuration of points</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#      0 - Exploring the data set  </span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#The data set is issued from a study that analysed several physico-chemical properties of several ponds. each pond is geolocalised</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Import the dataset</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>mare<span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"mares.txt"</span>,<span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       pH         Conductivity     Carbonate        hardness    
 Min.   :7.800   Min.   : 59.0   Min.   : 40.0   Min.   : 65.0  
 1st Qu.:7.900   1st Qu.:196.5   1st Qu.:145.0   1st Qu.:167.5  
 Median :7.900   Median :341.0   Median :160.0   Median :185.0  
 Mean   :7.935   Mean   :310.1   Mean   :148.9   Mean   :179.4  
 3rd Qu.:8.000   3rd Qu.:405.0   3rd Qu.:175.0   3rd Qu.:202.5  
 Max.   :8.200   Max.   :560.0   Max.   :200.0   Max.   :275.0  
  Bicarbonate       Chloride        Suspens          Organic      
 Min.   : 90.0   Min.   : 5.00   Min.   : 0.200   Min.   :0.3700  
 1st Qu.:150.0   1st Qu.:10.00   1st Qu.: 1.700   1st Qu.:0.4700  
 Median :165.0   Median :12.50   Median : 2.400   Median :0.5500  
 Mean   :158.7   Mean   :15.06   Mean   : 3.968   Mean   :0.5632  
 3rd Qu.:167.5   3rd Qu.:17.50   3rd Qu.: 4.500   3rd Qu.:0.6200  
 Max.   :190.0   Max.   :32.50   Max.   :19.000   Max.   :1.0000  
    Nitrate        Ammonia              x                y        
 Min.   :0.22   Min.   :0.00000   Min.   : 55.00   Min.   : 17.0  
 1st Qu.:0.70   1st Qu.:0.00000   1st Qu.: 78.00   1st Qu.: 88.0  
 Median :1.48   Median :0.01000   Median : 92.00   Median :148.0  
 Mean   :1.48   Mean   :0.02935   Mean   : 96.94   Mean   :162.1  
 3rd Qu.:2.05   3rd Qu.:0.03000   3rd Qu.:112.50   3rd Qu.:232.0  
 Max.   :5.52   Max.   :0.38000   Max.   :163.00   Max.   :317.0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(mare)<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">31</span>,<span class="dv">1</span>) <span class="co">#we name the ponds from 1 to 31.</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We can plot the ponds on a map according to their coordinates</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#We can see that the configuration of the ponds is not regular over space</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mare<span class="sc">$</span>x,mare<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="connection-among-neighbours" class="level3">
<h3 class="anchored" data-anchor-id="connection-among-neighbours"><strong>1.2 Connection among neighbours</strong></h3>
<p>In order to identify points in close proximity, it is imperative to establish specific criteria beyond merely considering distance along the x-axis. This approach will enable us to clearly define the parameters that determine proximity between points in our analysis.</p>
<section id="neighbourhood-criterion" class="level4">
<h4 class="anchored" data-anchor-id="neighbourhood-criterion"><strong>1.2.1 Neighbourhood criterion</strong></h4>
<p><strong>a) Defining neighbours based on distance</strong></p>
<p>Once we have a set of points spread across the territory, we can calculate the distance between them. These points may be specific locations where the information has been observed, or points representative of each zone, for example their centroid. In this case, the underlying assumption is that the distribution of the variable within each zone is sufficiently homogeneous to approximate it to a single point.</p>
<p>Neighbourhood graphs materialise the links between the various entities. They are defined in such a way that they represent the underlying spatial structure as closely as possible. There exists many different types of neighbourhood graphs.</p>
<p><strong>a.1) Neighbourhood graphs based on geometric concepts :</strong></p>
<p>• <strong>Delaunay’s Triangulation</strong> Delaunay’s Triangulation is a geometric method that connects points into triangles such that the minimum angle of all triangles is maximised.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1235549498.png" class="img-fluid figure-img" width="190"></p>
<figcaption class="figure-caption"><strong>Figure 2.2 :</strong> Delaunay triangle (source : Pascaline Le Gouar)</figcaption>
</figure>
</div>
<p>• <strong>Sphere-of-influence based graph</strong></p>
<p>The sphere-of-influence based graph links two points if their “circles from the nearest neighbour” overlap. The “circle of the nearest neighbour” of point <span class="math inline">\(P\)</span> is the largest circle centred in <span class="math inline">\(P\)</span> and that contains no other points than <span class="math inline">\(P\)</span>. All points in the study set are not necessarily interconnected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1767308128.png" class="img-fluid figure-img" width="361"></p>
<figcaption class="figure-caption"><strong>Figure 2.3 :</strong> The sphere of influence graph (edges) of a set of points, showing their nearest neighbour circles (source : Toussaint &amp; Emirates, 2014)</figcaption>
</figure>
</div>
<p>• <strong>Gabriel’s graph</strong></p>
<p>Gabriel’s graph links two points <span class="math inline">\(p_i\)</span> and <span class="math inline">\(p_j\)</span> if and only if all other points are outside the circle with diameter <span class="math inline">\([p_i, p_j]\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1231590752.png" class="img-fluid figure-img" width="227"></p>
<figcaption class="figure-caption"><strong>Figure 2.4 :</strong> Gabriel graph (source : Pascaline Le Gouar)</figcaption>
</figure>
</div>
<p>• <strong>Graph of relative neighbours</strong></p>
<p>The graph of relative neighbours considers that two points <span class="math inline">\(pi\)</span> and <span class="math inline">\(pj\)</span> are neighbours if <span class="math display">\[d(p_i,p_j) ≤ max [d(p_i,p_k),d(p_j,p_k)] \,\,\,\,\,\,∀k = 1,..., n k\ne i,j\]</span> with <span class="math inline">\(d(p_i, p_j)\)</span> the distance between <span class="math inline">\(p_i\)</span> and <span class="math inline">\(p_j\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1901385633.png" class="img-fluid figure-img" width="304"></p>
<figcaption class="figure-caption"><strong>Figure 2.5 :</strong> Graph of relative neighbours (source : J. O’Rourke, 1982)</figcaption>
</figure>
</div>
<p>For example, here’s the application of these geometric concepts to Parisian districts :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-691203873.png" class="img-fluid figure-img" width="610"></p>
<figcaption class="figure-caption"><strong>Figure 2.6 :</strong> Four neighbourhood graphs of Parisian districts based on geometric concepts</figcaption>
</figure>
</div>
<p><strong>Application in R :</strong></p>
<p>Coming back to our “<em>mares</em>” dataset, we can explore these geometric concepts :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset "mares"</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Connexions among neighbours</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For an IRREGULAR configuration of points</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Several criteria exist to connect points that are irregularly distributed.</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># It is necessary to tests several criteria to test different hypothesis and different scale of the phenomena.</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Criteria are determined when we have an a priori idea of the processes involved.</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co">#For example, may be due to eutrophication (lots of nutrients added, lots of organisms making excrements), heterogeneity in the pond - pond animal and plant communities may have an influence</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Two ponds should look alike because they're on the same soil</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Animals and plants: depending on the dispersal abilities of these species, will influence a pattern in water quality.</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Ponds supposed to be in a specific landscape will look alike.</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Larger-scale phenomena (flooding): if ponds are distributed in a valley, all the ponds will be homogenized.</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co">#      1 - Examine the connection between points ====================</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co"># for first step extract the coordinate</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>marexy<span class="ot">=</span>mare[,<span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">#           A - The gabriel graph method ---------------------------</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that for this function, the coordinates should be in a matrix:</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>mare.gab<span class="ot">&lt;-</span><span class="fu">gabrielneigh</span>(<span class="fu">as.matrix</span>(marexy))</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We can represent it spatially with this function:</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span>.<span class="dv">5</span>, <span class="at">cpoint=</span>.<span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(<span class="fu">graph2nb</span>(mare.gab)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the part nb2neig(graph2nb(mare.gab)) is necessary to translate the object from one package to another </span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># s.label is a function from ade4 and we need to translate our object from tripack-&gt;spdep-&gt;ade4</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># if we want a synthetic view of the neighbor relationship we can use this function:</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">graph2nb</span>(mare.gab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 31 
Number of nonzero links: 47 
Percentage nonzero weights: 4.890739 
Average number of links: 1.516129 
3 regions with no links:
13 28 31
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#31 pools, 47 links, each point will have an average of 1.5 neighbors, 3 regions have no links (31, 13, 28) = considered as non-neighbors</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>gab<span class="ot">=</span><span class="fu">graph2nb</span>(mare.gab)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co">#note: the ponds 13, 28 and 31 seems to have no link. This is just because they do not appear</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co">#in the $from object but only in the $to (this is a bug in the function - we would assume)</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#         B - The Delaunay triangulation graph method -----------</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#to compute a neighbor relationship using the delaunay triangulation method </span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">#We should use this function using directly the coordinates:</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>mare.tri<span class="ot">&lt;-</span><span class="fu">tri2nb</span>(marexy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sn2listw(df1): style is M (missing); style should be set to a valid
value</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graphic representation:</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span><span class="fl">0.6</span>,<span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(mare.tri))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># synthetic view:</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>mare.tri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 31 
Number of nonzero links: 164 
Percentage nonzero weights: 17.06556 
Average number of links: 5.290323 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#With this connection criterion, ponds have an average of 5.2 neighbors: more connections are created</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>a.2) Neighbourhood graphs based on nearest neighbours</strong></p>
<p>A second method consists in selecting the k closest points as neighbours. This method has the advantage that it leaves no point without a neighbour, which is not required when conducting a spatial analysis, but generally offers a better reflection of reality. The choice can also be made to keep only the points located at a certain distance.</p>
<p>For example :</p>
<ul>
<li><p>Nearest neighbour</p></li>
<li><p>Two nearest neighbour</p></li>
<li><p>Three nearest neighbour</p></li>
<li><p>Neighbours at a minimum distance</p>
<p>etc.</p></li>
</ul>
<p>Still using the example of Parisian districts, here’s the nearest neighbour application:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1634475889.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure 2.7 :</strong> Four graphs based on the nearest neighbours of Parisian districts</figcaption>
</figure>
</div>
<p>The <code>nbdists</code> function of R can be used to calculate the vector of distances between neighbours. It makes it possible to determine the minimum distance <span class="math inline">\(d_{min}\)</span> above which all points have at least one neighbour, then the <code>dnearneighb</code> function allows to keep as neighbours only the points between distances <span class="math inline">\(0\)</span> and <span class="math inline">\(d_{min}\)</span>.</p>
<p><strong>Application in R</strong></p>
<p>Let’s see what it looks like with the “<em>mares</em>” dataset with the criterion of neighbours at a minimum distance (30 km) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset "mares"</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Connexions among neighbours</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For an IRREGULAR configuration of points</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      1 - Examine the connection between points ====================</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for first step extract the coordinate </span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>marexy<span class="ot">=</span>mare[,<span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  C - The neighbours at a minimum distance criterion --------------------------</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># to compute a neighbor relationship using a distance criteria we should use this function using directly the coordinates as a matrix and indicating the min and max of distance.</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># the max of distance is defined depending on our knowledge of the system or for different hypothesis we want to test:</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>mare.dnear<span class="ot">&lt;-</span><span class="fu">dnearneigh</span>(<span class="fu">as.matrix</span>(marexy),<span class="dv">0</span>,<span class="dv">30</span>) <span class="co">#here we specify that ponds are connected if they are appart from less than 30m</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphic representation:</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span><span class="fl">0.6</span>, <span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(mare.dnear))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Synthetic view:</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>mare.dnear <span class="co">#in that specific case: the ponds 4 and 31 are not connected to any other pond</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 31 
Number of nonzero links: 80 
Percentage nonzero weights: 8.324662 
Average number of links: 2.580645 
2 regions with no links:
4 31
4 disjoint connected subgraphs</code></pre>
</div>
</div>
<p>Let’s then compare the current criterions in the <em>mares</em> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset "mares"</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Connexions among neighbours</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For an IRREGULAR configuration of points</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span>.<span class="dv">5</span>, <span class="at">cpoint=</span>.<span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(<span class="fu">graph2nb</span>(mare.gab))) <span class="co">#Gabriel</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span><span class="fl">0.6</span>,<span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(mare.tri))  <span class="co">#Triangulation</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">s.label</span>(marexy,<span class="at">clabel=</span><span class="fl">0.6</span>, <span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(mare.dnear)) <span class="co">#Neighbour at a min distance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#When comparing gabriel, triangulation and distance results, we observe different connexions.</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#We can think of several biological processes according to the different critera :</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Gabriel: we can imagine gradients in relation to the ground - we can also imagine a small hydro network that connects the two.</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Triangular: Flooding in a valley would make a connection on a larger scale</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Neighbour at a min distance: composition of plant and animal communities, dispersion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>b) Defining neighbours based on contiguity</strong></p>
<p>When the areal data consist in a partition of the entire territory, the concept of “distance between observations” can become quite ambiguous. The example below illustrates the limits of using the distance between centroids to define the notion of neighbourhood.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example - Ambiguity of the notion of distance between centroids
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(R_1\)</span>, <span class="math inline">\(R_2\)</span>, <span class="math inline">\(R_3\)</span> be three distinct zones. It can be considered that since <span class="math inline">\(R_2\)</span> and <span class="math inline">\(R_3\)</span> are separated in space, but both are adjacent to <span class="math inline">\(R_1\)</span>, they are both closer to <span class="math inline">\(R_1\)</span> than to one another. However, the centroids in these zones are equidistant from each other (see <em>Figure 2.8</em>). Summarising the proximity between zones by the distance between the centroids results in a partial loss of the richness of the spatial relationships.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-2131022957.png" class="img-fluid figure-img" width="579"></p>
<figcaption class="figure-caption"><strong>Figure</strong> <strong>2.8</strong> - Left: three zones - Right: distance between centroids (Source: Smith, 2016)</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Types of contiguity :</strong></p>
<ul>
<li><p><strong>Rook contiguity</strong></p>
<p>In the sense of Rook contiguity, neighbours have at least two common boundary points (a segment). This matches the movement of the Rook in chess.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1114536119.png" class="img-fluid figure-img" width="211"></p>
<figcaption class="figure-caption"><strong>Figure 2.9 :</strong> Rook configuration (source : Pascaline Le Gouar)</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Queen contiguity</strong></p>
<p>For two zones to be adjacent in the sense of Queen contiguity, they only need to share one common boundary point. This matches the movement of the Queen in chess.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-594369851.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure 2.10 :</strong> Queen configuration (source : Pascaline Le Gouar)</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Bishop contiguity</strong></p>
<p>In the sense of bishop contiguity, two regions are considered as spatial neighbors if they meet at one point ;it is based on the existence of common vertices between two spatial units. This matches the movement of the Bishop in chess.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-2117709373.png" class="img-fluid figure-img" width="177"></p>
<figcaption class="figure-caption"><strong>Figure 2.11 :</strong> Bishop configuration</figcaption>
</figure>
</div>
<p>Still using the example of Paris districts, here’s an example of how continuity can be applied:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-351519621.png" class="img-fluid figure-img" width="474"></p>
<figcaption class="figure-caption"><strong>Figure 2.12 :</strong> Queen and Rook contiguity in Paris districts</figcaption>
</figure>
</div>
<p><strong>Application in R</strong></p>
<p>We can return to the first dataset to investigate the configuration of the points :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset div35</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Connexion between points</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For a REGULAR configuration of points</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      1 - Examine the connection between points ====================</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co"># To investigate the various criteria of connection between points we need to</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the coordinates in a separate object</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>xy<span class="ot">=</span>div35[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co">#             A - If we choose that points are connected to their 4th nearest neighbors (the "rook connection") ----</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>div.knear4<span class="ot">&lt;-</span><span class="fu">knearneigh</span>(<span class="fu">as.matrix</span>(xy),<span class="dv">4</span>) <span class="co">#to extract the neighbour points</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>div.knear4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nn
      [,1] [,2] [,3] [,4]
 [1,]    2    3   10    4
 [2,]    3    1   10   16
 [3,]    2    4   16   10
 [4,]    5   25    3   34
 [5,]   34    4   25   42
 [6,]    7   11   12   10
 [7,]    6   12    8   11
 [8,]   13    7    9   12
 [9,]   14    8   13   20
[10,]   11   16    2   17
[11,]   10   12    6   17
[12,]    7   11   13   18
[13,]    8   19   12   14
[14,]    9   20   13   21
[15,]   23   22   24   32
[16,]   25   10   17    3
[17,]   18   26   16   11
[18,]   19   17   27   12
[19,]   18   28   20   13
[20,]   29   21   19   14
[21,]   30   20   22   14
[22,]   23   31   21   15
[23,]   22   15   24   32
[24,]   33   23   15   32
[25,]   34   16    4   26
[26,]   27   35   17   25
[27,]   36   28   26   18
[28,]   29   27   37   19
[29,]   28   38   20   30
[30,]   21   31   29   39
[31,]   32   40   30   22
[32,]   31   41   33   23
[33,]   24   32   23   41
[34,]    5   25   35   42
[35,]   26   43   34   36
[36,]   37   27   44   35
[37,]   38   36   28   45
[38,]   37   29   46   39
[39,]   47   38   40   30
[40,]   48   31   39   41
[41,]   49   32   40   48
[42,]   50   43   34   35
[43,]   44   35   42   51
[44,]   45   43   52   36
[45,]   46   44   37   53
[46,]   45   54   47   38
[47,]   39   55   46   48
[48,]   56   40   49   47
[49,]   41   48   40   56
[50,]   51   42   57   58
[51,]   50   58   52   43
[52,]   53   51   44   59
[53,]   54   52   60   45
[54,]   55   53   46   61
[55,]   56   54   47   62
[56,]   55   48   63   62
[57,]   58   50   51   42
[58,]   51   57   59   50
[59,]   64   52   60   58
[60,]   65   53   59   61
[61,]   62   54   66   60
[62,]   61   63   67   55
[63,]   68   62   56   67
[64,]   59   65   58   60
[65,]   60   64   66   59
[66,]   67   61   65   62
[67,]   68   62   66   61
[68,]   67   63   62   66

$np
[1] 68

$k
[1] 4

$dimension
[1] 2

$x
           x       y
 [1,] 565000 5285000
 [2,] 565000 5295000
 [3,] 575000 5295000
 [4,] 585000 5295000
 [5,] 595000 5295000
 [6,] 555000 5315000
 [7,] 555000 5325000
 [8,] 555000 5335000
 [9,] 555000 5345000
[10,] 565000 5305000
[11,] 565000 5315000
[12,] 565000 5325000
[13,] 565000 5335000
[14,] 565000 5345000
[15,] 565000 5375000
[16,] 575000 5305000
[17,] 575000 5315000
[18,] 575000 5325000
[19,] 575000 5335000
[20,] 575000 5345000
[21,] 575000 5355000
[22,] 575000 5365000
[23,] 575000 5375000
[24,] 575000 5385000
[25,] 585000 5305000
[26,] 585000 5315000
[27,] 585000 5325000
[28,] 585000 5335000
[29,] 585000 5345000
[30,] 585000 5355000
[31,] 585000 5365000
[32,] 585000 5375000
[33,] 585000 5385000
[34,] 595000 5305000
[35,] 595000 5315000
[36,] 595000 5325000
[37,] 595000 5335000
[38,] 595000 5345000
[39,] 595000 5355000
[40,] 595000 5365000
[41,] 595000 5375000
[42,] 605000 5305000
[43,] 605000 5315000
[44,] 605000 5325000
[45,] 605000 5335000
[46,] 605000 5345000
[47,] 605000 5355000
[48,] 605000 5365000
[49,] 605000 5375000
[50,] 615000 5305000
[51,] 615000 5315000
[52,] 615000 5325000
[53,] 615000 5335000
[54,] 615000 5345000
[55,] 615000 5355000
[56,] 615000 5365000
[57,] 625000 5305000
[58,] 625000 5315000
[59,] 625000 5325000
[60,] 625000 5335000
[61,] 625000 5345000
[62,] 625000 5355000
[63,] 625000 5365000
[64,] 635000 5325000
[65,] 635000 5335000
[66,] 635000 5345000
[67,] 635000 5355000
[68,] 635000 5365000

attr(,"class")
[1] "knn"
attr(,"call")
knearneigh(x = as.matrix(xy), k = 4)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">knn2nb</span>(div.knear4) <span class="co">#knn2nb convert the object returned by the function knearneigh to a class nb (necessary for the subsequent function)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The information printed corresponds to all the links that have been created compared to all those that could have been created (272)</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">knn2nb</span>(div.knear4)  <span class="co"># transformation to get as many lists than points/observation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">knn2nb</span>(div.knear4), xy, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#             B - If we specify a queen type of connection with points connected to their 8th nearest neighbors (the "queen connection") ----</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>div.knear8<span class="ot">&lt;-</span><span class="fu">knearneigh</span>(<span class="fu">as.matrix</span>(xy),<span class="dv">8</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>div.knear8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nn
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    2    3   10    4   16   25   11    5
 [2,]    3    1   10   16   11    4    6   25
 [3,]    2    4   16   10   25    1    5   17
 [4,]    5   25    3   34   16   26    2   35
 [5,]   34    4   25   42   35    3   26   16
 [6,]    7   11   12   10    8   17   13    2
 [7,]    6   12    8   11   13   18    9   10
 [8,]   13    7    9   12   14   19    6   11
 [9,]   14    8   13   20    7   21   12   19
[10,]   11   16    2   17    3    6   12   25
[11,]   10   12    6   17    7   16   18    2
[12,]    7   11   13   18    8   17    6   19
[13,]    8   19   12   14   20    9    7   18
[14,]    9   20   13   21    8   19   29   12
[15,]   23   22   24   32   33   31   21   30
[16,]   25   10   17    3   26   11    4    2
[17,]   18   26   16   11   27   12   10   25
[18,]   19   17   27   12   28   26   11   13
[19,]   18   28   20   13   12   27   29   14
[20,]   29   21   19   14   28   13   30   18
[21,]   30   20   22   14   29   31   23   39
[22,]   23   31   21   15   32   30   24   40
[23,]   22   15   24   32   31   33   21   41
[24,]   33   23   15   32   22   31   41   40
[25,]   34   16    4   26   35    5    3   17
[26,]   27   35   17   25   16   36   18   34
[27,]   36   28   26   18   17   37   19   35
[28,]   29   27   37   19   36   18   20   38
[29,]   28   38   20   30   37   21   19   39
[30,]   21   31   29   39   20   22   40   38
[31,]   32   40   30   22   23   21   41   39
[32,]   31   41   33   23   40   22   24   49
[33,]   24   32   23   41   31   15   22   40
[34,]    5   25   35   42    4   26   43   16
[35,]   26   43   34   36   25   42   27   44
[36,]   37   27   44   35   28   43   45   26
[37,]   38   36   28   45   29   44   46   27
[38,]   37   29   46   39   45   47   28   30
[39,]   47   38   40   30   48   46   31   29
[40,]   48   31   39   41   32   49   47   30
[41,]   49   32   40   48   33   31   23   39
[42,]   50   43   34   35    5   51   44   25
[43,]   44   35   42   51   50   36   52   34
[44,]   45   43   52   36   37   51   53   35
[45,]   46   44   37   53   52   38   36   54
[46,]   45   54   47   38   53   37   39   55
[47,]   39   55   46   48   54   56   38   40
[48,]   56   40   49   47   39   55   41   31
[49,]   41   48   40   56   32   47   31   63
[50,]   51   42   57   58   43   52   34   59
[51,]   50   58   52   43   59   44   57   42
[52,]   53   51   44   59   45   60   43   58
[53,]   54   52   60   45   46   59   44   61
[54,]   55   53   46   61   47   60   62   45
[55,]   56   54   47   62   61   48   63   46
[56,]   55   48   63   62   47   49   54   40
[57,]   58   50   51   42   59   64   52   43
[58,]   51   57   59   50   64   52   43   60
[59,]   64   52   60   58   51   65   53   44
[60,]   65   53   59   61   54   66   52   64
[61,]   62   54   66   60   55   67   53   65
[62,]   61   63   67   55   56   68   66   54
[63,]   68   62   56   67   55   61   48   66
[64,]   59   65   58   60   52   66   51   57
[65,]   60   64   66   59   61   53   67   52
[66,]   67   61   65   62   60   68   54   64
[67,]   68   62   66   61   63   55   65   56
[68,]   67   63   62   66   56   61   55   54

$np
[1] 68

$k
[1] 8

$dimension
[1] 2

$x
           x       y
 [1,] 565000 5285000
 [2,] 565000 5295000
 [3,] 575000 5295000
 [4,] 585000 5295000
 [5,] 595000 5295000
 [6,] 555000 5315000
 [7,] 555000 5325000
 [8,] 555000 5335000
 [9,] 555000 5345000
[10,] 565000 5305000
[11,] 565000 5315000
[12,] 565000 5325000
[13,] 565000 5335000
[14,] 565000 5345000
[15,] 565000 5375000
[16,] 575000 5305000
[17,] 575000 5315000
[18,] 575000 5325000
[19,] 575000 5335000
[20,] 575000 5345000
[21,] 575000 5355000
[22,] 575000 5365000
[23,] 575000 5375000
[24,] 575000 5385000
[25,] 585000 5305000
[26,] 585000 5315000
[27,] 585000 5325000
[28,] 585000 5335000
[29,] 585000 5345000
[30,] 585000 5355000
[31,] 585000 5365000
[32,] 585000 5375000
[33,] 585000 5385000
[34,] 595000 5305000
[35,] 595000 5315000
[36,] 595000 5325000
[37,] 595000 5335000
[38,] 595000 5345000
[39,] 595000 5355000
[40,] 595000 5365000
[41,] 595000 5375000
[42,] 605000 5305000
[43,] 605000 5315000
[44,] 605000 5325000
[45,] 605000 5335000
[46,] 605000 5345000
[47,] 605000 5355000
[48,] 605000 5365000
[49,] 605000 5375000
[50,] 615000 5305000
[51,] 615000 5315000
[52,] 615000 5325000
[53,] 615000 5335000
[54,] 615000 5345000
[55,] 615000 5355000
[56,] 615000 5365000
[57,] 625000 5305000
[58,] 625000 5315000
[59,] 625000 5325000
[60,] 625000 5335000
[61,] 625000 5345000
[62,] 625000 5355000
[63,] 625000 5365000
[64,] 635000 5325000
[65,] 635000 5335000
[66,] 635000 5345000
[67,] 635000 5355000
[68,] 635000 5365000

attr(,"class")
[1] "knn"
attr(,"call")
knearneigh(x = as.matrix(xy), k = 8)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">knn2nb</span>(div.knear8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 68 
Number of nonzero links: 544 
Percentage nonzero weights: 11.76471 
Average number of links: 8 
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the connection between points for each criterion</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="do">## MPE this in an intercative command, can not be used with a markodon document.</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>ade4<span class="sc">::</span><span class="fu">s.label</span>(xy, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(div35[,<span class="dv">4</span>])<span class="sc">-</span><span class="dv">10000</span>,<span class="fu">max</span>(div35[,<span class="dv">4</span>])<span class="sc">+</span><span class="dv">10000</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(div35[,<span class="dv">3</span>])<span class="sc">-</span><span class="dv">10000</span>,<span class="fu">max</span>(div35[,<span class="dv">3</span>])<span class="sc">+</span><span class="dv">10000</span>),  <span class="at">clabel=</span><span class="fl">0.6</span>, <span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(<span class="fu">knn2nb</span>(div.knear4)))</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>ade4<span class="sc">::</span><span class="fu">s.label</span>(xy, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fu">min</span>(div35[,<span class="dv">4</span>])<span class="sc">-</span><span class="dv">10000</span>,<span class="fu">max</span>(div35[,<span class="dv">4</span>])<span class="sc">+</span><span class="dv">10000</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(div35[,<span class="dv">3</span>])<span class="sc">-</span><span class="dv">10000</span>,<span class="fu">max</span>(div35[,<span class="dv">3</span>])<span class="sc">+</span><span class="dv">10000</span>),  <span class="at">clabel=</span><span class="fl">0.4</span>, <span class="at">cpoint=</span><span class="dv">1</span>,<span class="at">neig=</span><span class="fu">nb2neig</span>(<span class="fu">knn2nb</span>(div.knear8)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Be careful, the distance between points is not always 10km !</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>c) Defining neighbours based on the optimisation of a trajectory</strong></p>
<p>Some methods such as spatial sampling require prior data sorting. When the latter are characterised by two variables (i.e.&nbsp;their geographical coordinates in the plan), how to choose a sorting method becomes a complex theoretical problem.</p>
<p>One solution consists in running a path along all the points, and sorting them by their order of appearance when the path is taken. The neighbours of a given point are then the points located just before or just after along the path. Out of the set of possible paths, some have characteristics that are better suited to the desired objectives, such as, for instance, reducing sampling variance.</p>
<ul>
<li><p><strong>Shortest path (Hamilton path)</strong></p>
<p>This is the case of the <strong>shortest path</strong>. It minimises the sum of the distances between two consecutive points. This path, which does not set any particular constraints on the starting or arrival point, is known in the literature as the <strong>Hamilton path</strong> (<em>Figure 2.13b</em>).</p></li>
<li><p><strong>Hamiltonian cycle</strong></p>
<p>A particular and well-known case of shortest path is that of the travelling salesman. It represents the path which a travelling salesman must take to visit all his customers, minimising the distance travelled and managing to return home in the evenings. Such a path corresponds to a <strong>Hamiltonian cycle</strong> (<em>Figure 2.13c</em>).</p>
<p>The <code>TSP</code> package in R allows to compute this thanks to the function <code>insert-dummy</code> and the <code>concorde</code> program.</p></li>
<li><p><strong>General randomized tessellation stratified method (GRTS)</strong></p></li>
</ul>
<p>The <strong><em>general randomized tessellation stratified method</em></strong> (GRTS, Stevens Jr et al.&nbsp;2004) is popular in spatial sampling, as it makes it possible to get a spatially-balanced sample for a finite population of individuals (distinct and identifiable units of dimension 0 of a discrete population, e.g.&nbsp;trees in a forest), a linear population (continuous units of dimension 1, e.g.&nbsp;rivers) or a population of surfaces (continuous units of dimension 2, e.g.&nbsp;forests).</p>
<p>The idea of the method is to project the coordinates on a unit square, then cut this square into four cells, each of which is cut again into four sub-cells, etc. To each cell, a value is assigned, resulting from the order in which the division was carried out, ultimately making it possible for the units to be placed on the path going through the two-dimensional space.</p>
<p>This method can be implemented with package <code>spsurvey</code> in R (Kincaid et al.&nbsp;2016). However, with the GRTS method, <em>large jumps</em> (<em>Figures 2.13d</em>) are created along the paths, which can affect the accuracy of the estimates.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1294038395.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 2.13 : Looking for paths that cross through all the neighbourhoods of Paris</figcaption>
</figure>
</div>
</section>
</section>
<section id="neighborhood-weights" class="level3">
<h3 class="anchored" data-anchor-id="neighborhood-weights"><strong>1.3 Neighborhood weights</strong></h3>
<section id="from-a-list-of-neighbours-to-a-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="from-a-list-of-neighbours-to-a-weight-matrix"><strong>1.3.1 From a list of neighbours to a weight matrix</strong></h4>
<p>Once the neighbourhood graph has been defined and codified into a list of neighbours, the link between points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> is transformed into the element <span class="math inline">\(w_{ij}\)</span> of the weight matrix <span class="math inline">\(W\)</span>. The weight matrix <span class="math inline">\(W\)</span> is the “formal expression of spatial dependency between observations” (Anselin et al.&nbsp;1988)<br>
Formally, the weights express the neighbor structure between the observations as a <span class="math inline">\(n\times n\)</span> matrix <span class="math inline">\(W\)</span> in which the elements <span class="math inline">\(w_{ij}\)</span> of the matrix are the spatial weights:</p>
<p><img src="image-672436714.png" class="img-fluid" width="285"></p>
<p><strong>Defining the weight matrix</strong></p>
<p>Most commonly, the weight matrix is a binary contiguity matrix (see <em>Figure 2.13</em>):</p>
<blockquote class="blockquote">
<p><img src="image-562063019.png" class="img-fluid" width="431"></p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-497770688.png" class="img-fluid figure-img" width="592"></p>
<figcaption class="figure-caption"><strong>Figure 2.14 :</strong> Binary weight matrix</figcaption>
</figure>
</div>
<p>The weight matrices can also take into account the <strong>distance</strong> between the geographical zones, as relationships becoming smaller with distance: <span class="math inline">\(1\)</span> if <span class="math inline">\(d &lt; d_0 - 0\)</span> otherwise, <span class="math inline">\(\frac{1}{d^α}\)</span> , or <span class="math inline">\(e^{−αd}\)</span> with <span class="math inline">\(α\)</span> an estimated or predetermined parameter. Using a maximum distance beyond which <span class="math inline">\(w_{ij} = 0\)</span> makes it possible to limit the number of components with a value different from zero. When the size of the zones is heterogeneous, this method increases the risk of a considerable variability in the number of neighbours.</p>
<p>Lastly, certain matrices take the <strong>strength of relations</strong> between the zones into account. For example, weight can be defined by <span class="math inline">\(\frac{b^α_{ij}}{d^β_{ij}}\)</span> with <span class="math inline">\(b_{ij}\)</span> a measure of the strength of relationships between zones <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> (which is not necessarily symmetrical), such as the percentage of common boundaries, the total population, the wealth and <span class="math inline">\(d_{ij}\)</span> the distance between the zones.</p>
<p><strong>Application in R</strong></p>
<p>Let’s go back to our previous data set, <em>div35</em>, to see the transformation into a binary matrix :</p>
<pre><code>::: {.cell}

```{.r .cell-code}
#Spatial series analysis : dataset div35
#Weight matrix
#For a REGULAR configuration of points

# about the code : 
# nb2neig(knn2nb()) transform the matrix to subsequently use it is ade4
# neig = define the connection matrix between points

#             Transform the list of the names of the neighbors to a 2 by 2 matrix of neighboors with "0" and "1" -----

w2&lt;-knn2nb(div.knear4)
str(w2)                     # we have as much list as points
```

::: {.cell-output .cell-output-stdout}
```
List of 68
 $ : int [1:4] 2 3 4 10
 $ : int [1:4] 1 3 10 16
 $ : int [1:4] 2 4 10 16
 $ : int [1:4] 3 5 25 34
 $ : int [1:4] 4 25 34 42
 $ : int [1:4] 7 10 11 12
 $ : int [1:4] 6 8 11 12
 $ : int [1:4] 7 9 12 13
 $ : int [1:4] 8 13 14 20
 $ : int [1:4] 2 11 16 17
 $ : int [1:4] 6 10 12 17
 $ : int [1:4] 7 11 13 18
 $ : int [1:4] 8 12 14 19
 $ : int [1:4] 9 13 20 21
 $ : int [1:4] 22 23 24 32
 $ : int [1:4] 3 10 17 25
 $ : int [1:4] 11 16 18 26
 $ : int [1:4] 12 17 19 27
 $ : int [1:4] 13 18 20 28
 $ : int [1:4] 14 19 21 29
 $ : int [1:4] 14 20 22 30
 $ : int [1:4] 15 21 23 31
 $ : int [1:4] 15 22 24 32
 $ : int [1:4] 15 23 32 33
 $ : int [1:4] 4 16 26 34
 $ : int [1:4] 17 25 27 35
 $ : int [1:4] 18 26 28 36
 $ : int [1:4] 19 27 29 37
 $ : int [1:4] 20 28 30 38
 $ : int [1:4] 21 29 31 39
 $ : int [1:4] 22 30 32 40
 $ : int [1:4] 23 31 33 41
 $ : int [1:4] 23 24 32 41
 $ : int [1:4] 5 25 35 42
 $ : int [1:4] 26 34 36 43
 $ : int [1:4] 27 35 37 44
 $ : int [1:4] 28 36 38 45
 $ : int [1:4] 29 37 39 46
 $ : int [1:4] 30 38 40 47
 $ : int [1:4] 31 39 41 48
 $ : int [1:4] 32 40 48 49
 $ : int [1:4] 34 35 43 50
 $ : int [1:4] 35 42 44 51
 $ : int [1:4] 36 43 45 52
 $ : int [1:4] 37 44 46 53
 $ : int [1:4] 38 45 47 54
 $ : int [1:4] 39 46 48 55
 $ : int [1:4] 40 47 49 56
 $ : int [1:4] 40 41 48 56
 $ : int [1:4] 42 51 57 58
 $ : int [1:4] 43 50 52 58
 $ : int [1:4] 44 51 53 59
 $ : int [1:4] 45 52 54 60
 $ : int [1:4] 46 53 55 61
 $ : int [1:4] 47 54 56 62
 $ : int [1:4] 48 55 62 63
 $ : int [1:4] 42 50 51 58
 $ : int [1:4] 50 51 57 59
 $ : int [1:4] 52 58 60 64
 $ : int [1:4] 53 59 61 65
 $ : int [1:4] 54 60 62 66
 $ : int [1:4] 55 61 63 67
 $ : int [1:4] 56 62 67 68
 $ : int [1:4] 58 59 60 65
 $ : int [1:4] 59 60 64 66
 $ : int [1:4] 61 62 65 67
 $ : int [1:4] 61 62 66 68
 $ : int [1:4] 62 63 66 67
 - attr(*, "region.id")= chr [1:68] "1" "2" "3" "4" ...
 - attr(*, "call")= language knearneigh(x = as.matrix(xy), k = 4)
 - attr(*, "sym")= logi FALSE
 - attr(*, "type")= chr "knn"
 - attr(*, "knn-k")= num 4
 - attr(*, "class")= chr "nb"
```
:::

```{.r .cell-code}
nb2neig(knn2nb(div.knear4)) # these lists are transformed in a 2D matrix with 0 or 1.
```

::: {.cell-output .cell-output-stdout}
```
1 .
2 1.
3 11.
4 1.1.
5 ...1.
6 ......
7 .....1.
8 ......1.
9 .......1.
10 111..1....
11 .....11..1.
12 .....111..1.
13 .......11..1.
14 ........1...1.
15 ...............
16 .11......1......
17 .........11....1.
18 ...........1....1.
19 ............1....1.
20 ........1....1....1.
21 .............1.....1.
22 ..............1.....1.
23 ..............1......1.
24 ..............1.......1.
25 ...11..........1.........
26 ................1.......1.
27 .................1.......1.
28 ..................1.......1.
29 ...................1.......1.
30 ....................1.......1.
31 .....................1.......1.
32 ..............1.......11......1.
33 ......................11.......1.
34 ...11...................1.........
35 .........................1.......1.
36 ..........................1.......1.
37 ...........................1.......1.
38 ............................1.......1.
39 .............................1.......1.
40 ..............................1.......1.
41 ...............................11......1.
42 ....1............................11.......
43 ..................................1......1.
44 ...................................1......1.
45 ....................................1......1.
46 .....................................1......1.
47 ......................................1......1.
48 .......................................11.....1.
49 .......................................11......1.
50 .........................................1........
51 ..........................................1......1.
52 ...........................................1......1.
53 ............................................1......1.
54 .............................................1......1.
55 ..............................................1......1.
56 ...............................................11.....1.
57 .........................................1.......11......
58 .................................................11.....1.
59 ...................................................1.....1.
60 ....................................................1.....1.
61 .....................................................1.....1.
62 ......................................................11....1.
63 .......................................................1.....1.
64 .........................................................111....
65 ..........................................................11...1.
66 ............................................................11..1.
67 ............................................................111..1.
68 .............................................................11..11.
```
:::
:::</code></pre>
</section>
<section id="weight-matrix-standardisation" class="level4">
<h4 class="anchored" data-anchor-id="weight-matrix-standardisation"><strong>1.3.2 Weight matrix standardisation</strong></h4>
<p>The sum of the weights of the neighbours of a zone is called its <em>degree of connection</em>. If the weight matrix is not standardised (“<span class="math inline">\(B\)</span>” coding scheme), the degree of connection will depend on the number of its neighbours, which creates heterogeneity between the zones. According to Tiefelsdorf (1998), four types of standardisation can be distinguished:</p>
<p>— <strong>Line standardisation</strong> (<em>“W” coding scheme</em>): for a given zone, the weight ascribed to each neighbour is divided by the sum of the weights of its neighbours : <span class="math inline">\(∑^n_{j=1}w_{ij} = 1\)</span>. This standardisation makes the interpretation of the weight matrix easier, because <span class="math inline">\(∑^n_{j=1}w_{ij}x_j\)</span> represents the average of variable <span class="math inline">\(x\)</span> on all neighbours of observation <span class="math inline">\(i\)</span>. Each weight <span class="math inline">\(w_{ij}\)</span> can be interpreted as the fraction of spatial influence on observation <span class="math inline">\(i\)</span> ascribable to <span class="math inline">\(j\)</span>. In contrast, such standardisation implies a certain degree of competition between neighbours: the fewer neighbours a zone has, the greater their weight. Moreover, when weights are inversely proportional to the distance between the zones, row standardisation makes them difficult to interpret.</p>
<p>— <strong>Global standardisation</strong> <em>(“C” coding scheme)</em>: weights are standardised so that the sum of all weights is equal to the total number of entities. All weights are multiplied by <span class="math inline">\(\frac{n}{∑^n_{j=1}∑^n_{i=1}w_{ij}}\)</span>.</p>
<p>— <strong>Uniform standardisation</strong> (<em>“U” coding scheme</em>): weights are standardised so that the sum of all weights equals <span class="math inline">\(1\)</span> : <span class="math inline">\(∑^n_{j=1}∑^n_{i=1}w_{ij} = 1\)</span>.</p>
<p>— <strong>Standardisation by variance stabilisation</strong> (<em>“S” coding scheme</em>): let <strong>q</strong> be the vector defined by : <strong>q</strong> = <span class="math inline">\((\sqrt{∑^n_{j=1}w^2_{1j}}, \sqrt{∑^n_{j=1}w^2_{2j}},...., \sqrt{∑^n_{j=1}w^2_{nj}})^T\)</span>. Let matrix <span class="math inline">\(S^∗\)</span> = <span class="math inline">\([diag(q)]^{−1}W.^4\)</span> From <span class="math inline">\(S^*\)</span>, we calculate <span class="math inline">\(Q = ∑^n_{j=1}∑^n_{i=1} s^∗_{ij}\)</span> from which we deduce the standardised weight matrix: <span class="math inline">\(S = \frac{n}{Q} S^∗\)</span>.</p>
</section>
<section id="importance-of-the-choice-of-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="importance-of-the-choice-of-weight-matrix"><strong>1.3.3 Importance of the choice of weight matrix</strong></h4>
<p>When trying to test the importance of economic or social relationships between certain variables, the geographical location of the observations is a key parameter. First of all, observations in the same geographical zone are subject to the same external parameters (climate, pollution, etc.) Secondly, neighbouring observations mutually influence one another. Spatial models take these various interactions into account ; these models use neighbourhood specification via weight matrix <span class="math inline">\(W\)</span>.</p>
<p><strong>The “weight list” object in R</strong></p>
<p>The function <code>nb2listw</code> of package <em>spdep</em> makes it possible to convert a “list of neighbours” object into a “weight list” object. It is important to note that the “weight list” object, which corresponds to the weight matrix described above, is not a matrix n×n as represented in theory. It is a list containing the standardisation style and then for each observation: its attribute, the list of observation numbers of its neighbours, the list of the attributes of its neighbours and the list of the weights of its neighbours. Reference is often made to sparse matrices. When a zone has no neighbours, the option <code>zero.policy=TRUE</code> makes it possible to generate a list of weights which takes value ‘zero’ for observations without neighbours (if the option is <code>FALSE</code>, an error message is generated).</p>
<p><strong>Application in R</strong></p>
<p>In the dataset “<em>div35</em>” :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset div35</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Weight matrix</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For a REGULAR configuration of points</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      2 - Define the spatial weight matrix</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Note that spatial weight matrix is always associated to a neighborhood matrix (if two points are not considered as connected,</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co">#their spatial weight is of "0")</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="co">#             A - In the case in which points are connected to their 4th nearest neighbours (the "rook connection") ----</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="co">#compare spatial weighted matrix with rook connection (that is with the 4th nearest neighbors)</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co">#but different weight formulation (binary B vs standardized W)</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>pond4.bin<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear4), <span class="at">style=</span><span class="st">"B"</span>,<span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="co"># "B" for binary = all connections have the same weight</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>pond4.stan<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear4), <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="co"># "W" for standardized (line standardisation) = 1/nb of connections</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>pond4.bin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list

Weights style: B 
Weights constants summary:
   n   nn  S0  S1   S2
B 68 4624 272 510 4438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>pond4.stan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list

Weights style: W 
Weights constants summary:
   n   nn S0     S1      S2
W 68 4624 68 31.875 277.375</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>pond4.bin<span class="sc">$</span>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 1 1 1

[[2]]
[1] 1 1 1 1

[[3]]
[1] 1 1 1 1

[[4]]
[1] 1 1 1 1

[[5]]
[1] 1 1 1 1

[[6]]
[1] 1 1 1 1

[[7]]
[1] 1 1 1 1

[[8]]
[1] 1 1 1 1

[[9]]
[1] 1 1 1 1

[[10]]
[1] 1 1 1 1

[[11]]
[1] 1 1 1 1

[[12]]
[1] 1 1 1 1

[[13]]
[1] 1 1 1 1

[[14]]
[1] 1 1 1 1

[[15]]
[1] 1 1 1 1

[[16]]
[1] 1 1 1 1

[[17]]
[1] 1 1 1 1

[[18]]
[1] 1 1 1 1

[[19]]
[1] 1 1 1 1

[[20]]
[1] 1 1 1 1

[[21]]
[1] 1 1 1 1

[[22]]
[1] 1 1 1 1

[[23]]
[1] 1 1 1 1

[[24]]
[1] 1 1 1 1

[[25]]
[1] 1 1 1 1

[[26]]
[1] 1 1 1 1

[[27]]
[1] 1 1 1 1

[[28]]
[1] 1 1 1 1

[[29]]
[1] 1 1 1 1

[[30]]
[1] 1 1 1 1

[[31]]
[1] 1 1 1 1

[[32]]
[1] 1 1 1 1

[[33]]
[1] 1 1 1 1

[[34]]
[1] 1 1 1 1

[[35]]
[1] 1 1 1 1

[[36]]
[1] 1 1 1 1

[[37]]
[1] 1 1 1 1

[[38]]
[1] 1 1 1 1

[[39]]
[1] 1 1 1 1

[[40]]
[1] 1 1 1 1

[[41]]
[1] 1 1 1 1

[[42]]
[1] 1 1 1 1

[[43]]
[1] 1 1 1 1

[[44]]
[1] 1 1 1 1

[[45]]
[1] 1 1 1 1

[[46]]
[1] 1 1 1 1

[[47]]
[1] 1 1 1 1

[[48]]
[1] 1 1 1 1

[[49]]
[1] 1 1 1 1

[[50]]
[1] 1 1 1 1

[[51]]
[1] 1 1 1 1

[[52]]
[1] 1 1 1 1

[[53]]
[1] 1 1 1 1

[[54]]
[1] 1 1 1 1

[[55]]
[1] 1 1 1 1

[[56]]
[1] 1 1 1 1

[[57]]
[1] 1 1 1 1

[[58]]
[1] 1 1 1 1

[[59]]
[1] 1 1 1 1

[[60]]
[1] 1 1 1 1

[[61]]
[1] 1 1 1 1

[[62]]
[1] 1 1 1 1

[[63]]
[1] 1 1 1 1

[[64]]
[1] 1 1 1 1

[[65]]
[1] 1 1 1 1

[[66]]
[1] 1 1 1 1

[[67]]
[1] 1 1 1 1

[[68]]
[1] 1 1 1 1

attr(,"mode")
[1] "binary"
attr(,"B")
[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#List of created weights associated with the neighbor relationship</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co">#when points are neighbors = 1, otherwise = 0. Translated into list, numerical value put into calculation</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Here : constant criterion for all points</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>pond4.stan<span class="sc">$</span>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.25 0.25 0.25 0.25

[[2]]
[1] 0.25 0.25 0.25 0.25

[[3]]
[1] 0.25 0.25 0.25 0.25

[[4]]
[1] 0.25 0.25 0.25 0.25

[[5]]
[1] 0.25 0.25 0.25 0.25

[[6]]
[1] 0.25 0.25 0.25 0.25

[[7]]
[1] 0.25 0.25 0.25 0.25

[[8]]
[1] 0.25 0.25 0.25 0.25

[[9]]
[1] 0.25 0.25 0.25 0.25

[[10]]
[1] 0.25 0.25 0.25 0.25

[[11]]
[1] 0.25 0.25 0.25 0.25

[[12]]
[1] 0.25 0.25 0.25 0.25

[[13]]
[1] 0.25 0.25 0.25 0.25

[[14]]
[1] 0.25 0.25 0.25 0.25

[[15]]
[1] 0.25 0.25 0.25 0.25

[[16]]
[1] 0.25 0.25 0.25 0.25

[[17]]
[1] 0.25 0.25 0.25 0.25

[[18]]
[1] 0.25 0.25 0.25 0.25

[[19]]
[1] 0.25 0.25 0.25 0.25

[[20]]
[1] 0.25 0.25 0.25 0.25

[[21]]
[1] 0.25 0.25 0.25 0.25

[[22]]
[1] 0.25 0.25 0.25 0.25

[[23]]
[1] 0.25 0.25 0.25 0.25

[[24]]
[1] 0.25 0.25 0.25 0.25

[[25]]
[1] 0.25 0.25 0.25 0.25

[[26]]
[1] 0.25 0.25 0.25 0.25

[[27]]
[1] 0.25 0.25 0.25 0.25

[[28]]
[1] 0.25 0.25 0.25 0.25

[[29]]
[1] 0.25 0.25 0.25 0.25

[[30]]
[1] 0.25 0.25 0.25 0.25

[[31]]
[1] 0.25 0.25 0.25 0.25

[[32]]
[1] 0.25 0.25 0.25 0.25

[[33]]
[1] 0.25 0.25 0.25 0.25

[[34]]
[1] 0.25 0.25 0.25 0.25

[[35]]
[1] 0.25 0.25 0.25 0.25

[[36]]
[1] 0.25 0.25 0.25 0.25

[[37]]
[1] 0.25 0.25 0.25 0.25

[[38]]
[1] 0.25 0.25 0.25 0.25

[[39]]
[1] 0.25 0.25 0.25 0.25

[[40]]
[1] 0.25 0.25 0.25 0.25

[[41]]
[1] 0.25 0.25 0.25 0.25

[[42]]
[1] 0.25 0.25 0.25 0.25

[[43]]
[1] 0.25 0.25 0.25 0.25

[[44]]
[1] 0.25 0.25 0.25 0.25

[[45]]
[1] 0.25 0.25 0.25 0.25

[[46]]
[1] 0.25 0.25 0.25 0.25

[[47]]
[1] 0.25 0.25 0.25 0.25

[[48]]
[1] 0.25 0.25 0.25 0.25

[[49]]
[1] 0.25 0.25 0.25 0.25

[[50]]
[1] 0.25 0.25 0.25 0.25

[[51]]
[1] 0.25 0.25 0.25 0.25

[[52]]
[1] 0.25 0.25 0.25 0.25

[[53]]
[1] 0.25 0.25 0.25 0.25

[[54]]
[1] 0.25 0.25 0.25 0.25

[[55]]
[1] 0.25 0.25 0.25 0.25

[[56]]
[1] 0.25 0.25 0.25 0.25

[[57]]
[1] 0.25 0.25 0.25 0.25

[[58]]
[1] 0.25 0.25 0.25 0.25

[[59]]
[1] 0.25 0.25 0.25 0.25

[[60]]
[1] 0.25 0.25 0.25 0.25

[[61]]
[1] 0.25 0.25 0.25 0.25

[[62]]
[1] 0.25 0.25 0.25 0.25

[[63]]
[1] 0.25 0.25 0.25 0.25

[[64]]
[1] 0.25 0.25 0.25 0.25

[[65]]
[1] 0.25 0.25 0.25 0.25

[[66]]
[1] 0.25 0.25 0.25 0.25

[[67]]
[1] 0.25 0.25 0.25 0.25

[[68]]
[1] 0.25 0.25 0.25 0.25

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
[39] 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#             B - In the case in which points are connected to their 8th nearest neighbors (the "queen connection") ----</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="co">#compare spatial weighted matrix with  queen connection</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#but different weight formulation (binary B vs standardized [line standardisation] W)</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>pond8.bin<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear8), <span class="at">style=</span><span class="st">"B"</span>,<span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>pond8.stan<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear8), <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>pond8.bin<span class="sc">$</span>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 1 1 1 1 1 1 1

[[2]]
[1] 1 1 1 1 1 1 1 1

[[3]]
[1] 1 1 1 1 1 1 1 1

[[4]]
[1] 1 1 1 1 1 1 1 1

[[5]]
[1] 1 1 1 1 1 1 1 1

[[6]]
[1] 1 1 1 1 1 1 1 1

[[7]]
[1] 1 1 1 1 1 1 1 1

[[8]]
[1] 1 1 1 1 1 1 1 1

[[9]]
[1] 1 1 1 1 1 1 1 1

[[10]]
[1] 1 1 1 1 1 1 1 1

[[11]]
[1] 1 1 1 1 1 1 1 1

[[12]]
[1] 1 1 1 1 1 1 1 1

[[13]]
[1] 1 1 1 1 1 1 1 1

[[14]]
[1] 1 1 1 1 1 1 1 1

[[15]]
[1] 1 1 1 1 1 1 1 1

[[16]]
[1] 1 1 1 1 1 1 1 1

[[17]]
[1] 1 1 1 1 1 1 1 1

[[18]]
[1] 1 1 1 1 1 1 1 1

[[19]]
[1] 1 1 1 1 1 1 1 1

[[20]]
[1] 1 1 1 1 1 1 1 1

[[21]]
[1] 1 1 1 1 1 1 1 1

[[22]]
[1] 1 1 1 1 1 1 1 1

[[23]]
[1] 1 1 1 1 1 1 1 1

[[24]]
[1] 1 1 1 1 1 1 1 1

[[25]]
[1] 1 1 1 1 1 1 1 1

[[26]]
[1] 1 1 1 1 1 1 1 1

[[27]]
[1] 1 1 1 1 1 1 1 1

[[28]]
[1] 1 1 1 1 1 1 1 1

[[29]]
[1] 1 1 1 1 1 1 1 1

[[30]]
[1] 1 1 1 1 1 1 1 1

[[31]]
[1] 1 1 1 1 1 1 1 1

[[32]]
[1] 1 1 1 1 1 1 1 1

[[33]]
[1] 1 1 1 1 1 1 1 1

[[34]]
[1] 1 1 1 1 1 1 1 1

[[35]]
[1] 1 1 1 1 1 1 1 1

[[36]]
[1] 1 1 1 1 1 1 1 1

[[37]]
[1] 1 1 1 1 1 1 1 1

[[38]]
[1] 1 1 1 1 1 1 1 1

[[39]]
[1] 1 1 1 1 1 1 1 1

[[40]]
[1] 1 1 1 1 1 1 1 1

[[41]]
[1] 1 1 1 1 1 1 1 1

[[42]]
[1] 1 1 1 1 1 1 1 1

[[43]]
[1] 1 1 1 1 1 1 1 1

[[44]]
[1] 1 1 1 1 1 1 1 1

[[45]]
[1] 1 1 1 1 1 1 1 1

[[46]]
[1] 1 1 1 1 1 1 1 1

[[47]]
[1] 1 1 1 1 1 1 1 1

[[48]]
[1] 1 1 1 1 1 1 1 1

[[49]]
[1] 1 1 1 1 1 1 1 1

[[50]]
[1] 1 1 1 1 1 1 1 1

[[51]]
[1] 1 1 1 1 1 1 1 1

[[52]]
[1] 1 1 1 1 1 1 1 1

[[53]]
[1] 1 1 1 1 1 1 1 1

[[54]]
[1] 1 1 1 1 1 1 1 1

[[55]]
[1] 1 1 1 1 1 1 1 1

[[56]]
[1] 1 1 1 1 1 1 1 1

[[57]]
[1] 1 1 1 1 1 1 1 1

[[58]]
[1] 1 1 1 1 1 1 1 1

[[59]]
[1] 1 1 1 1 1 1 1 1

[[60]]
[1] 1 1 1 1 1 1 1 1

[[61]]
[1] 1 1 1 1 1 1 1 1

[[62]]
[1] 1 1 1 1 1 1 1 1

[[63]]
[1] 1 1 1 1 1 1 1 1

[[64]]
[1] 1 1 1 1 1 1 1 1

[[65]]
[1] 1 1 1 1 1 1 1 1

[[66]]
[1] 1 1 1 1 1 1 1 1

[[67]]
[1] 1 1 1 1 1 1 1 1

[[68]]
[1] 1 1 1 1 1 1 1 1

attr(,"mode")
[1] "binary"
attr(,"B")
[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>pond8.stan<span class="sc">$</span>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[2]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[3]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[4]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[5]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[6]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[7]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[8]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[9]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[10]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[11]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[12]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[13]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[14]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[15]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[16]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[17]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[18]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[19]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[20]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[21]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[22]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[23]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[24]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[25]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[26]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[27]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[28]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[29]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[30]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[31]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[32]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[33]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[34]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[35]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[36]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[37]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[38]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[39]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[40]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[41]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[42]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[43]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[44]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[45]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[46]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[47]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[48]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[49]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[50]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[51]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[52]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[53]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[54]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[55]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[56]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[57]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[58]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[59]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[60]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[61]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[62]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[63]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[64]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[65]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[66]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[67]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

[[68]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

attr(,"mode")
[1] "binary"
attr(,"W")
[1] TRUE
attr(,"comp")
attr(,"comp")$d
 [1] 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8
[39] 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#             C - In the case in which points are connected to their 4th nearest neighbors but the weight is inversely proportional to the distance (weight = 1/distance)</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co">#To get inverse distance, we need to calculate the distances between all of the neighbours. </span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co">#for this we will use nbdists, which gives us the distances in a similar structure to our input neighbors list. To use this function we need to input the neighbours list and the coordinates.</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(div35<span class="sc">$</span>x,div35<span class="sc">$</span>y)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(<span class="fu">knn2nb</span>(div.knear4),coords)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>distances[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 10000.01 14142.14 22360.69 20000.03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>distances[<span class="dv">34</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1]  9999.987  9999.993 10000.008 10000.018</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating the inverse distances (the 1/distance gives very small values so we make an adjustement)</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>invd1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(distances, <span class="cf">function</span>(x) (<span class="dv">1</span><span class="sc">/</span>x))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(invd1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 68</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>invd1[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 9.999994e-05 7.071067e-05 4.472134e-05 4.999993e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>invd.weights <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear4),<span class="at">glist =</span> invd1,<span class="at">style =</span> <span class="st">"B"</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(invd.weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list
Link number distribution:

 4 
68 
68 least connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 with 4 links
68 most connected regions:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 with 4 links

Weights style: B 
Weights constants summary:
   n   nn         S0           S1           S2
B 68 4624 0.02584031 4.834501e-06 4.031344e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>invd.weights<span class="sc">$</span>weights[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 9.999994e-05 7.071067e-05 4.472134e-05 4.999993e-05</code></pre>
</div>
</div>
<p>Let’s see what it looks like in the second dataset, “<em>mares</em>” :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset mares</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Weight matrix</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For a IRREGULAR configuration of points</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      2 - Define the spatial weight matrix =========================</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example : BINARY criterion</span></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>pondmaretri.bin <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(mare.tri, <span class="at">style=</span><span class="st">"B"</span>,<span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>pondmaregab.bin <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(mare.gab), <span class="at">style=</span><span class="st">"B"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>pondmarednear.bin <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(mare.dnear, <span class="at">style=</span><span class="st">"B"</span>,<span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co">#There are points without neighbours</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
</section>
<section id="spatial-autocorrelation-indices" class="level2">
<h2 class="anchored" data-anchor-id="spatial-autocorrelation-indices"><strong>2 - Spatial autocorrelation indices</strong></h2>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Spatial autocorrelation indices measure the spatial dependence between values of the same variable in different places in space. The more the observation values are influenced by observation values that are geographically close to them, the greater the spatial correlation.</p>
</div>
</div>
<section id="global-measures-of-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation"><strong>2.1 Global measures of spatial autocorrelation</strong></h3>
<section id="spatial-autocorrelation-indices-1" class="level4">
<h4 class="anchored" data-anchor-id="spatial-autocorrelation-indices-1"><strong>2.1.1 Spatial autocorrelation indices</strong></h4>
<p>Calculating the spatial autocorrelation indices is used to answer two questions:</p>
<p>— Could the values taken by the neighbouring observations have been comparable (or also dissimilar) by mere chance?</p>
<p>— If not, then we are dealing with a case of spatial autocorrelation. How is this denoted and what is the strength of the said autocorrelation?</p>
<p>To answer the first question, we must test the hypothesis of absence of spatial autocorrelation for a gross variable y.</p>
<p>— <span class="math inline">\(H_0\)</span>: no spatial autocorrelation</p>
<p>— <span class="math inline">\(H_1\)</span>: spatial autocorrelation</p>
<p>To carry out this test, it is necessary to specify the distribution of the variable of interest y, in the absence of spatial autocorrelation (under <span class="math inline">\(H_0\)</span>). In this context, statistical inference is generally conducted considering either of the following assumptions:</p>
<p><strong>Normality hypothesis:</strong> each of the values of the variable, or <span class="math inline">\(y_i\)</span>, is the result of an independent draw in the normal distribution specific to each geographical area <span class="math inline">\(i\)</span> on which this variable is measured.</p>
<p><strong>Randomisation hypothesis:</strong> The inference over Moran’s I is usually conducted under the randomisation hypothesis. The estimated statistic calculated from data is compared with the distribution of the data derived by randomly re-ordering the data – permutations. The idea is simply that if the null hypothesis is true, then all possible combinations of data are equiprobable. The data observed are then only one of the many outcomes possible. In the case of spatial autocorrelation, the null hypothesis is always that there is no spatial association and the values of the variable are randomly assigned to the spatial units in order to calculate the test statistic. If the null hypothesis is rejected, i.e.&nbsp;if spatial autocorrelation is found, we can then calculate the range of values that governs the spatial autocorrelation index and thus answer the question as to the signals and strength of the spatial autocorrelation: the closest this index is to 1 in absolute value, the greater is the correlation. This interval depends on the weight matrix and can sometimes vary outside the interval [−1; 1], hence the importance of calculating the limits of this interval.</p>
<p>For example, here is the difference between a simulated random distribution and the real distribution in the case of the median income earned by Parisians in the different Parisian districts :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-1092496314.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure 2.15 :</strong> Illustration, on Parisian census districts (IRIS), of the gap between random distribution and spatially autocorrelated distribution - Source: INSEE, Localised Tax Revenues System (RFL) 2010</figcaption>
</figure>
</div>
<p>Very generally speaking, spatial autocorrelation indices are used to characterise the correlation between measures that are geographically similar to a measured phenomenon. If <span class="math inline">\(WY\)</span> is the vector of means of variable <span class="math inline">\(Y\)</span> (where <span class="math inline">\(W\)</span> is the spatial weights matrix) in the neighbourhood of each spatial unit, spatial autocorrelation indices occur as:</p>
<p><span class="math display">\[Corr(Y,WY) = \frac{Cov(Y,WY)}{\sqrt{Var(Y).Var(WY)}}\]</span></p>
<p>Based on this very general formulation, for quantitative variables, a main indice is used to test for spatial autocorrelation — the Moran index. The Moran index considers the variances and covariances taking into account the difference between each observation and the average of all observations.</p>
<p><strong>Moran index</strong></p>
<p><span class="math display">\[I_W =
\frac{n}{∑_i∑_jw_{ij}}\frac{∑_i∑_jw_{ij}(y_i −\bar{y})(y_j − \bar{y})}{∑_i(y_i −\bar{y})²} \,\,\,\,\,\,\,\,\,\,i\ne{j}\]</span></p>
<p>— <span class="math inline">\(H_0\)</span>: The neighbours do not <strong>co-vary</strong> in any particular way.</p>
<p>— <span class="math inline">\(I_W &gt; 0\)</span> =&gt; positive spatial autocorrelation</p>
<p>As spatial autocorrelation is measured based on a comparison of the value of an individual variable with that of its neighbours, the definition of the neighbourhood will have a significant impact on the measurement of spatial autocorrelation. The larger the planned neighbourhood, the greater the number of neighbours considered, and the greater the probability that their average will be closer to the population’s average, which may lead to a relatively low value for spatial autocorrelation.</p>
<p><strong>Application in R</strong></p>
<p>The <em>spdep</em> package is used to calculate spatial autocorrelation indices and their significance using function <code>moran.test</code>.<br>
<br>
By default, the distribution of the variable of interest under the null hypothesis is derived by randomisation. The <code>randomisation = FALSE</code> argument makes it possible to assume that this is a normal distribution.<br>
</p>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If certain entities do not have neighbours
</div>
</div>
<div class="callout-body-container callout-body">
<p>order for the package functions <em>spdep</em> to accept spatial weight matrices in which certain units do not have neighbours, it is necessary to specify the option: <code>zero.policy=TRUE</code>. By default, the size of the matrix is reduced to exclude observations without neighbours. The opposite can be specified with the option: <code>adjust.n=FALSE</code>. In this case, the absolute value of the test statistic increases, and the absolute value of its expected maturity and variance decreases (Bivand et al.&nbsp;2013a).</p>
</div>
</div>
<p>Two approaches are used to estimate the significance of these indices — an analytical solution based on the normality hypothesis and a Monte Carlo solution based on the randomisation hypothesis. The analytical solution, used by the <code>moran.test</code> function, is based on the assumption that the test statistic asymptotically follows a normal distribution with mean 0 and variance 1. This is not always the most accurate measure of significance as convergence towards this distribution may depend on the arrangement of the polygons. Instead, the <code>moran.mc</code> function can be used, allowing to choose the number of permutations to calculate the simulated distribution of Moran’s I. Comparing the significance levels calculated from functions <code>moran.mc</code> and <code>moran.test</code> makes it possible to ensure the robustness of the conclusions.</p>
<blockquote class="blockquote">
<h4 id="monte-carlo-approach-to-estimating-significance" class="anchored">Monte Carlo approach to estimating significance</h4>
<p>In a Monte Carlo test (a permutation bootstrap test), the attribute values are randomly assigned to polygons in the data set and, for each permutation of the attribute values, a Moran’s I value is computed. The output is a sampling distribution of Moran’s I values under the (null) hypothesis that attribute values are randomly distributed across the study area. We then compare our observed Moran’s I value to this sampling distribution.</p>
</blockquote>
<blockquote class="blockquote">
<img src="image-318830441.png" class="img-fluid" width="380" alt="Figure 2.16 : Output of the Monte Carlo test">
</blockquote>
<p>For example, the <strong>Mantel test</strong> is using the Monte Carlo method.</p>
<p>Let’s explore the <strong>Moran Global Index</strong> in the <em>mares</em> dataset :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset mares</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Moran Global Index</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#For a REGULAR configuration of points</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#      3 - The Moran Global Index  ==================================</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's test the global spatial autocorrelation for carbonates and each criterion using the Moran test (possible because the carbonate is a quantitative variable)</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Carbonate, pondmaregab.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Carbonate  
weights: pondmaregab.bin  n reduced by no-neighbour observations
  

Moran I statistic standard deviate = 1.4378, p-value = 0.07524
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.15443932       -0.03703704        0.01773410 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Carbonate, pondmaretri.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Carbonate  
weights: pondmaretri.bin    

Moran I statistic standard deviate = 1.8498, p-value = 0.03217
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.145853163      -0.033333333       0.009383014 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Carbonate, pondmarednear.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Carbonate  
weights: pondmarednear.bin  n reduced by no-neighbour observations
  

Moran I statistic standard deviate = 1.4158, p-value = 0.07842
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.16716343       -0.03571429        0.02053503 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#No significant autocorrelation for all tests:</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Only for the 2nd one (triangulation). For carbonate, we have something significant - for Gabriel and distance, not significant.</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Rather, large-scale processes determine the distribution of carbonate concentration.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We could also look at spatial autocorrelation with other variables to see if we reach the same conclusion</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Nitrate, pondmaregab.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Nitrate  
weights: pondmaregab.bin  n reduced by no-neighbour observations
  

Moran I statistic standard deviate = 0.49064, p-value = 0.3118
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.02036859       -0.03703704        0.01368928 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Nitrate, pondmaretri.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Nitrate  
weights: pondmaretri.bin    

Moran I statistic standard deviate = 1.2281, p-value = 0.1097
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.07342432       -0.03333333        0.00755716 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mare<span class="sc">$</span>Nitrate, pondmarednear.bin, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mare$Nitrate  
weights: pondmarednear.bin  n reduced by no-neighbour observations
  

Moran I statistic standard deviate = 1.0102, p-value = 0.1562
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
       0.09328084       -0.03571429        0.01630642 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--&gt; No spatial structure with the 3 criteria</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Spatial autocorrelation in multivariate data</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset mares</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#The Mantel test (using the Monte Carlo method)</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#For a REGULAR configuration of points</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="do">############SPATIAL AUTOCORRELATION IN MULTIVARIATE DATA##############</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co">#The Mantel test (using the Monte Carlo method)</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co">#In case of multivariate data it can be useful to have a test that sum up the spatial autocorrelation for  all characteristics/variables</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="co">#In that case, we need to test the correlation between a matrix of geographical distance and a matrix of distance of the characteristics between objects </span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">#To compute a geographical distance matrix you can use the function dist that </span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="co">#compute an euclidian distance</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>geo <span class="ot">=</span> <span class="fu">dist</span>(marexy)</span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="co">#To compute the matrix of distance of the characteristics between objects, </span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co">#we can have our own measure (genetic distance, similarity etc...) </span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="co"># or compute an euclidean distance between the object </span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="co"># it is usually advice to scale the data if they are not measure on the same scale (ie to divide by the standard</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="co">#deviation)</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>chim <span class="ot">=</span> <span class="fu">dist</span>(<span class="fu">scale</span>(mare[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]),<span class="at">method =</span> <span class="st">"euclidian"</span>)</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="co"># the test used to correlate those two matrix is a Mantel test, it uses randomization of the values </span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="co">#to have the expected distribution under H0</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a><span class="co"># H0: the correlation between teh two matrix is null : there is no spatial autocorrelation</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">=</span> <span class="fu">mantel.rtest</span>(geo,chim,<span class="at">nrepet=</span><span class="dv">1000</span>)</span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a><span class="co">#nrepet = to specify the number of permutations</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a><span class="co"># or r1 = mantel.randtest(geo,chim,nrepet=1000)</span></span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>r1 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Monte-Carlo test
Call: mantel.rtest(m1 = geo, m2 = chim, nrepet = 1000)

Observation: 0.2437815 

Based on 1000 replicates
Simulated p-value: 0.006993007 
Alternative hypothesis: greater 

     Std.Obs  Expectation     Variance 
 2.908960278 -0.001557550  0.007113084 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r1, <span class="at">main =</span> <span class="st">"Mantel's test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Significant</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Indicator far from what is expected if permutations are involved</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Ponds that are close will look alike</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial dependence</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spatial-autocorrelation-of-categorical-variables" class="level4">
<h4 class="anchored" data-anchor-id="spatial-autocorrelation-of-categorical-variables"><strong>2.1.2 Spatial autocorrelation of categorical variables</strong></h4>
<p>When the variable of interest is not continuous but categorical, the degree of local association is measured by analysing the statistics of the join count (Zhukov 2010). To illustrate the calculation of these statistics, we consider a binary variable representing two colours, White (B) and Black (N) so that a relation can be called White-White, Black-Black or White-Black. It can be seen that:</p>
<p>— <strong>positive spatial autocorrelation</strong> occurs if the number of White-Black relations is <strong>significantly lower</strong> than what would have occurred with random spatial distribution;</p>
<p>— <strong>negative spatial autocorrelation</strong> occurs if the number of White-Black relations is <strong>significantly greater</strong> than what would have occurred with random spatial distribution;</p>
<p>— <strong>no positive spatial autocorrelation</strong> occurs if the number of White-Black links is <strong>approximately identical</strong> to what would have occurred with random spatial distribution;</p>
</section>
</section>
<section id="local-measures-of-spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="local-measures-of-spatial-autocorrelation"><strong>2.2 Local measures of spatial autocorrelation</strong></h3>
<p>Global statistics are based on the <strong>assumption of a spatial stationary process</strong>: spatial autocorrelation would be the same throughout space. However, this assumption is all the less realistic as the number of observations is high.</p>
<section id="local-spatial-autocorrelation-indicators" class="level4">
<h4 class="anchored" data-anchor-id="local-spatial-autocorrelation-indicators"><strong>2.2.1 Local spatial autocorrelation indicators</strong></h4>
<p>Anselin (Anselin 1995) defines <em>local spatial autocorrelation indicators</em>. These must measure the intensity and significance of local autocorrelation between the value of a variable in a spatial unit and the value of the same variable in the surrounding spatial units. More specifically, these indicators make it possible to:</p>
<p>— detect significant groupings of identical values around a particular location (clusters);</p>
<p>— identify spatial non-stationarity zones, which do not follow the global process.</p>
<p>To be considered as local spatial association measures – (LISA; <em>Local Indicators of Spatial Association</em>) – as defined by Anselin, these indicators must verify the following two properties:</p>
<p>— for each observation, they indicate the intensity of the grouping of similar – or opposite in trend – values around this observation;</p>
<p>— the sum of local indices on all observations is proportional to the corresponding global index. One of the most used LISA is the local Moran’s I.</p>
<p><strong>Local Moran’s I</strong> <span class="math display">\[I_i = (y_i −\bar{y})\sum \limits_{\underset{}{j}}w_{ij}(y_j −\bar{y})\]</span> <span class="math display">\[I_W = constante ∗\sum \limits_{\underset{}i}I_i\]</span></p>
<p><span class="math inline">\(Ii &gt; 0\)</span> indicates a grouping of similar values (higher or lower than average).</p>
<p><span class="math inline">\(Ii &lt; 0\)</span> indicates a combination of dissimilar values (e.g.&nbsp;high values surrounded by low values).</p>
<p>Here is an example with the median income in the different Parisian districts :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image-979262065.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure 2.17 :</strong> Values of local Moran’s I, on Parisian IRIS - Source: INSEE, Localised Tax Revenues System (RFL) 2010</figcaption>
</figure>
</div>
</section>
<section id="significance-of-the-local-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="significance-of-the-local-morans-i"><strong>2.2.2 Significance of the local Moran’s I</strong></h4>
<p>Significant LISAs are combinations of similar or dissimilar values more marked than what might have been observed based on random spatial distribution. The significance test of each local association indicator is based on a statistic assumed to asymptotically follow a normal distribution under the null hypothesis. If the assumption of normality holds, <span class="math inline">\(z(I_i) = \frac{I−E(I_i)}{\sqrt{Var(I_i)}}∼ N (0,1)\)</span>.</p>
<p>To test the validity of the normality assumption of the LISAs under the null hypothesis, several random distributions are simulated in the space of the variable of interest and the local indicators associated with these simulations are calculated.</p>
<p>Several adjustments methods can then be used : “<em>bonferroni</em>”, “<em>holm</em>”, etc.</p>
</section>
<section id="interpretation-of-local-indices" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-local-indices"><strong>2.2.3 Interpretation of local indices</strong></h4>
<p><strong>In the absence of global spatial autocorrelation</strong></p>
<p>The LISAs make it possible to identify areas where similar values are significantly grouped. These are areas where the local spatial structure is such that the relations between neighbours are particularly strong.</p>
<p><strong>In the presence of global spatial autocorrelation</strong></p>
<p>LISAs indicate areas that have a <strong>particular impact on the global process</strong> (local autocorrelation more pronounced than global autocorrelation), <strong>or, on the contrary, which stand out from it</strong> (lower autocorrelation).</p>
<p><strong>Application with R</strong></p>
<p>Let’s investigate this in the <em>div35</em> dataset :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial series analysis : dataset div35</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Local Moran Index</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#For a REGULAR configuration of points</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             2 - The Local Moran Index                                           ----</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Due to the large extend of the dataset (scale of Brittany), we might expect non stationary issue</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co">#We will investigate this via the Local Moran Index. The autocorrelaton is computed for each point taking into account their neighbours.</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's start with plant diversity:</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For the PLANTS</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>localI.pp1<span class="ot">=</span>spdep<span class="sc">::</span><span class="fu">localmoran</span>(div35[,<span class="dv">1</span>], pond4.bin)</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>localI.pp1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Ii         E.Ii     Var.Ii         Z.Ii Pr(z != E(Ii))
1   3.888286246 -0.090487416  5.7405874  1.660623069    0.096789173
2   3.392860034 -0.046011342  2.9522005  2.001441977    0.045344781
3   2.772659813 -0.046011342  2.9522005  1.640482051    0.100904977
4   0.730402871 -0.016433658  1.0623114  0.724602181    0.468696120
5  -0.744866294 -0.017090940  1.1046174 -0.692454769    0.488651781
6   2.027685582 -0.016433658  1.0623114  1.983263007    0.047338059
7   2.148789768 -0.090487416  5.7405874  0.934608416    0.349990140
8   1.334088885 -0.017090940  1.1046174  1.285604009    0.198581297
9   1.389136242 -0.823575799 42.4509690  0.339610489    0.734149878
10  2.772659813 -0.046011342  2.9522005  1.640482051    0.100904977
11  2.583663887 -0.090487416  5.7405874  1.116112079    0.264374162
12  1.286381176 -0.016433658  1.0623114  1.264028249    0.206219888
13  0.389109258 -0.017090940  1.1046174  0.386486383    0.699136486
14 -0.730186999 -0.001754363  0.1138241 -2.159097257    0.030842622
15 -4.678917402 -0.674372813 36.3931084 -0.663809645    0.506812152
16  1.842359481 -0.046011342  2.9522005  1.099042162    0.271749676
17  0.480854853 -0.001754363  0.1138241  1.430468903    0.152582485
18 -0.010901535 -0.016433658  1.0623114  0.005367424    0.995717436
19 -0.922852748 -0.047106812  3.0216512 -0.503797452    0.614403718
20 -0.752205942 -0.016433658  1.0623114 -0.713867334    0.475309218
21 -0.366874443 -0.017090940  1.1046174 -0.332807718    0.739279432
22  0.581775007 -0.001973457  0.1280321  1.631422156    0.102801273
23 -2.499042068 -0.046011342  2.9522005 -1.427677319    0.153384757
24 -1.493510348 -0.016433658  1.0623114 -1.433102092    0.151828664
25  0.420302760 -0.001754363  0.1138241  1.250990595    0.210937909
26  0.299198575 -0.001754363  0.1138241  0.892033979    0.372374720
27  0.480854853 -0.001754363  0.1138241  1.430468903    0.152582485
28 -0.010901535 -0.016433658  1.0623114  0.005367424    0.995717436
29 -0.124666073 -0.001973457  0.1280321 -0.342893327    0.731678712
30 -0.124666073 -0.001754363  0.1138241 -0.364314177    0.715623414
31  0.067999676 -0.001973457  0.1280321  0.195556350    0.844957428
32 -0.003561888 -0.001754363  0.1138241 -0.005357561    0.995725305
33 -0.744866294 -0.017090940  1.1046174 -0.692454769    0.488651781
34  0.601959038 -0.046011342  2.9522005  0.377122311    0.706082712
35  3.018538007 -0.090487416  5.7405874  1.297615742    0.194419410
36  4.444264551 -0.149861878  9.3629567  1.501400079    0.133252113
37  2.152459591 -0.046011342  2.9522005  1.279522125    0.200713253
38 -1.122858145 -0.017090940  1.1046174 -1.052101820    0.292752837
39 -0.185218166 -0.001754363  0.1138241 -0.543792485    0.586584280
40  0.389109258 -0.017090940  1.1046174  0.386486383    0.699136486
41  0.067999676 -0.001973457  0.1280321  0.195556350    0.844957428
42 -0.445775655 -0.001973457  0.1280321 -1.240309455    0.214860957
43 -0.253109906 -0.001973457  0.1280321 -0.701859778    0.482766615
44  1.101055074 -0.016433658  1.0623114  1.084219560    0.278267461
45  2.462559702 -0.046011342  2.9522005  1.460002088    0.144289500
46  1.713915648 -0.090487416  5.7405874  0.753104752    0.451386969
47 -0.253109906 -0.001973457  0.1280321 -0.701859778    0.482766615
48  0.200113333 -0.017090940  1.1046174  0.206662857    0.836273167
49 -0.752205942 -0.016433658  1.0623114 -0.713867334    0.475309218
50 -1.122858145 -0.016433658  1.0623114 -1.073484713    0.283053694
51  0.260665425 -0.001973457  0.1280321  0.734006027    0.462945065
52 -0.060444157 -0.001973457  0.1280321 -0.163410101    0.870195550
53  0.238646483 -0.001754363  0.1138241  0.712555671    0.476120751
54  3.888286246 -0.090487416  5.7405874  1.660623069    0.096789173
55 -0.566879840 -0.016433658  1.0623114 -0.534058645    0.593300961
56  0.774440757 -0.001973457  0.1280321  2.169871833    0.030016557
57  0.260665425 -0.001973457  0.1280321  0.734006027    0.462945065
58  0.033136350 -0.151833724  9.4812939  0.060071388    0.952098778
59  0.645996924 -0.001973457  0.1280321  1.810905382    0.070155499
60 -0.744866294 -0.017090940  1.1046174 -0.692454769    0.488651781
61 -1.765077309 -0.090487416  5.7405874 -0.698924554    0.484599181
62  4.169027767 -0.226544763 13.8719900  1.180174068    0.237930990
63 10.615073262 -0.316154192 18.8993089  2.514467166    0.011921240
64  2.657060363 -0.092021073  5.8355936  1.138007394    0.255117395
65 -0.366874443 -0.001754363  0.1138241 -1.082227409    0.279151492
66  0.389109258 -0.001973457  0.1280321  1.092972479    0.274405883
67  2.849726112 -0.151833724  9.4812939  0.974794795    0.329662060
68  5.352545940 -0.047106812  3.0216512  3.106301938    0.001894432
attr(,"call")
spdep::localmoran(x = div35[, 1], listw = pond4.bin)
attr(,"class")
[1] "localmoran" "matrix"     "array"     
attr(,"quadr")
        mean    median     pysal
1  High-High High-High High-High
2  High-High High-High High-High
3  High-High High-High High-High
4  High-High High-High High-High
5   Low-High  Low-High  Low-High
6  High-High High-High High-High
7  High-High High-High High-High
8    Low-Low   Low-Low   Low-Low
9    Low-Low   Low-Low   Low-Low
10 High-High High-High High-High
11 High-High High-High High-High
12 High-High High-High High-High
13   Low-Low   Low-Low   Low-Low
14  High-Low   Low-Low  High-Low
15  Low-High  Low-High  Low-High
16 High-High High-High High-High
17 High-High  Low-High High-High
18  High-Low  High-Low  High-Low
19  Low-High  Low-High  Low-High
20  High-Low  High-Low  High-Low
21  Low-High  Low-High  Low-High
22   Low-Low   Low-Low   Low-Low
23  High-Low  High-Low  High-Low
24  High-Low  High-Low  High-Low
25 High-High  Low-High High-High
26 High-High  Low-High High-High
27 High-High  Low-High High-High
28  High-Low  High-Low  High-Low
29  Low-High  Low-High  Low-High
30  High-Low   Low-Low  High-Low
31   Low-Low   Low-Low   Low-Low
32  High-Low   Low-Low  High-Low
33  Low-High  Low-High  Low-High
34 High-High High-High High-High
35 High-High High-High High-High
36 High-High High-High High-High
37 High-High High-High High-High
38  Low-High  Low-High  Low-High
39  High-Low   Low-Low  High-Low
40   Low-Low   Low-Low   Low-Low
41   Low-Low   Low-Low   Low-Low
42  Low-High  Low-High  Low-High
43  Low-High  Low-High  Low-High
44 High-High High-High High-High
45 High-High High-High High-High
46 High-High High-High High-High
47  Low-High  Low-High  Low-High
48   Low-Low   Low-Low   Low-Low
49  High-Low  High-Low  High-Low
50  High-Low  High-Low  High-Low
51   Low-Low   Low-Low   Low-Low
52  Low-High   Low-Low  Low-High
53 High-High  Low-High High-High
54 High-High High-High High-High
55  High-Low  High-Low  High-Low
56   Low-Low   Low-Low   Low-Low
57   Low-Low   Low-Low   Low-Low
58   Low-Low   Low-Low   Low-Low
59   Low-Low   Low-Low   Low-Low
60  Low-High  Low-High  Low-High
61  High-Low  High-Low  High-Low
62   Low-Low   Low-Low   Low-Low
63   Low-Low   Low-Low   Low-Low
64   Low-Low   Low-Low   Low-Low
65  High-Low   Low-Low  High-Low
66   Low-Low   Low-Low   Low-Low
67   Low-Low   Low-Low   Low-Low
68   Low-Low   Low-Low   Low-Low</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Instead of 1 index, there are 68.</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co">#For plants: 6 points where we have a significant index</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the five columns correspond respectively to:</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co"># first column without header: the atlas square number (point i)</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ii: the Moran index at point i</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="co"># E.Ii: the expected value of the Moran index at point i under H0</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Var.Ii: the variance of the index</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ZIi the variable of the test</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Pr(Z&gt;0) p value of the test adjusted with bonferonni correction</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We can isolate the significant points like this:</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>localI.pp1[localI.pp1[,<span class="dv">5</span>]<span class="sc">&lt;</span><span class="fl">0.05</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii         E.Ii     Var.Ii      Z.Ii Pr(z != E(Ii))
2   3.3928600 -0.046011342  2.9522005  2.001442    0.045344781
6   2.0276856 -0.016433658  1.0623114  1.983263    0.047338059
14 -0.7301870 -0.001754363  0.1138241 -2.159097    0.030842622
56  0.7744408 -0.001973457  0.1280321  2.169872    0.030016557
63 10.6150733 -0.316154192 18.8993089  2.514467    0.011921240
68  5.3525459 -0.047106812  3.0216512  3.106302    0.001894432</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the BIRDS</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>localI.oi1<span class="ot">=</span><span class="fu">localmoran</span>(div35[,<span class="dv">2</span>], pond8.bin)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>localI.oi1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Ii          E.Ii       Var.Ii         Z.Ii Pr(z != E(Ii))
1    2.103998978 -0.1629313507   9.70253707  0.727772293    0.466752988
2   -0.402453047 -0.0031781809   0.19311812 -0.908574316    0.363574869
3   -3.147821643 -0.0820174075   4.93455032 -1.380132010    0.167546003
4    1.304714450 -0.0626533870   3.77873904  0.703415461    0.481796874
5    2.812060815 -0.2307054227  13.61966397  0.824490000    0.409661196
6    0.661811678 -0.0626533870   3.77873904  0.372686788    0.709381571
7   -0.149056684 -0.0031781809   0.19311812 -0.331955433    0.739922912
8    0.014564967 -0.0004118922   0.02503677  0.094652402    0.924590926
9    0.844257059 -0.0177011963   1.07363733  0.831873774    0.405480197
10  -2.044461479 -0.0820174075   4.93455032 -0.883432755    0.377002500
11   1.074485754 -0.1069140054   6.41222033  0.466544055    0.640826121
12   0.567693028 -0.0094023304   0.57087598  0.763794796    0.444989539
13  -0.004258762 -0.0031781809   0.19311812 -0.002458929    0.998038060
14   0.417103190 -0.0177011963   1.07363733  0.419628634    0.674756767
15  -0.259103105 -0.0004118922   0.02503677 -1.634905124    0.102068938
16   0.131851284 -0.0004118922   0.02503677  0.835891342    0.403216034
17   2.544184660 -0.1069140054   6.41222033  1.046939710    0.295127385
18   0.816745454 -0.0094023304   0.57087598  1.093419603    0.274209610
19  -1.497125335 -0.0439809385   2.65881004 -0.891179354    0.372832958
20  -2.074869043 -0.1069140054   6.41222033 -0.777160920    0.437063836
21   2.340019590 -0.5571274838  31.50809639  0.516130424    0.605763320
22   0.755930327 -0.0031781809   0.19311812  1.727397718    0.084096260
23   3.081384950 -0.0439809385   2.65881004  1.916713549    0.055274333
24   2.770069418 -0.1318106033   7.88047063  1.033721086    0.301266573
25   1.574038584 -0.0301494953   1.82581690  1.187207614    0.235145738
26   3.174055619 -0.1069140054   6.41222033  1.295680705    0.195085511
27   2.577488182 -0.0301494953   1.82581690  1.929828145    0.053628135
28   0.236105788 -0.0004118922   0.02503677  1.494770399    0.134974374
29  -1.444998084 -0.1069140054   6.41222033 -0.528419925    0.597207911
30   0.357736042 -0.0031781809   0.19311812  0.821282331    0.411485469
31   5.613900600 -0.1933605258  11.46988183  1.714714747    0.086397538
32  -2.391976492 -0.0626533870   3.77873904 -1.198274408    0.230810206
33  -1.113410843 -0.0094023304   0.57087598 -1.461172653    0.143968066
34 -12.611813807 -0.3517305513  20.44091227 -2.711710247    0.006693708
35   7.195093906 -0.3102362215  18.12727415  1.762802055    0.077933881
36   8.324517695 -0.1629313507   9.70253707  2.724799336    0.006434058
37   3.715599847 -0.0626533870   3.77873904  1.943647984    0.051937915
38   0.157914910 -0.0004118922   0.02503677  1.000611106    0.317014859
39   0.246241642 -0.0177011963   1.07363733  0.254730579    0.798931197
40   0.321536561 -0.0031781809   0.19311812  0.738908205    0.459962739
41   1.287338699 -0.2666671752  15.66979316  0.392573540    0.694634486
42   3.876325540 -0.0626533870   3.77873904  2.026330152    0.042730963
43   5.587836975 -0.2307054227  13.61966397  1.576634432    0.114879665
44   6.743324390 -0.1069140054   6.41222033  2.705213010    0.006826060
45   4.223840552 -0.1069140054   6.41222033  1.710249030    0.087219833
46   1.128060985 -0.0301494953   1.82581690  0.857154045    0.391359756
47   0.040628593 -0.0004118922   0.02503677  0.259372166    0.795348103
48   0.926791874 -0.0439809385   2.65881004  0.595352183    0.551608081
49  -7.745155658 -0.1629313507   9.70253707 -2.434187191    0.014925274
50   0.443166816 -0.0094023304   0.57087598  0.598982392    0.549184626
51   3.384012606 -0.1069140054   6.41222033  1.378594370    0.168019853
52   0.197010349 -0.0004118922   0.02503677  1.247690752    0.212144329
53   0.505429922 -0.0094023304   0.57087598  0.681388594    0.495625638
54  -0.463268174 -0.0626533870   3.77873904 -0.206088389    0.836721868
55   0.719730846 -0.0031781809   0.19311812  1.645023592    0.099964946
56  -3.356330650 -0.0626533870   3.77873904 -1.694367417    0.090195487
57   0.816745454 -0.0094023304   0.57087598  1.093419603    0.274209610
58   0.079724032 -0.0004118922   0.02503677  0.506451813    0.612539509
59  -0.257655125 -0.0031781809   0.19311812 -0.579077812    0.562536671
60   0.438822878 -0.1318106033   7.88047063  0.203273691    0.838921118
61   0.574932924 -0.0031781809   0.19311812  1.315527088    0.188332820
62   7.898811805 -0.1318106033   7.88047063  2.860705354    0.004226997
63  24.379711256 -2.5274165775 105.09842847  2.624636904    0.008674141
64   0.246241642 -0.0177011963   1.07363733  0.254730579    0.798931197
65  -3.195604957 -0.0626533870   3.77873904 -1.611685249    0.107030449
66   5.597972829 -0.2666671752  15.66979316  1.481527532    0.138466054
67  10.571781440 -0.2666671752  15.66979316  2.738012907    0.006181165
68   7.898811805 -0.1318106033   7.88047063  2.860705354    0.004226997
attr(,"call")
localmoran(x = div35[, 2], listw = pond8.bin)
attr(,"class")
[1] "localmoran" "matrix"     "array"     
attr(,"quadr")
        mean    median     pysal
1  High-High High-High High-High
2   Low-High  Low-High  Low-High
3   Low-High  Low-High  Low-High
4  High-High High-High High-High
5  High-High High-High High-High
6  High-High  High-Low High-High
7   Low-High   Low-Low  Low-High
8  High-High   Low-Low High-High
9    Low-Low   Low-Low   Low-Low
10  Low-High  Low-High  Low-High
11 High-High High-High High-High
12 High-High High-High High-High
13   Low-Low   Low-Low  Low-High
14   Low-Low   Low-Low   Low-Low
15  High-Low   Low-Low  High-Low
16 High-High  Low-High High-High
17 High-High High-High High-High
18 High-High High-High High-High
19  Low-High  Low-High  Low-High
20  High-Low  High-Low  High-Low
21   Low-Low   Low-Low   Low-Low
22   Low-Low   Low-Low   Low-Low
23   Low-Low   Low-Low   Low-Low
24   Low-Low   Low-Low   Low-Low
25 High-High High-High High-High
26 High-High High-High High-High
27 High-High High-High High-High
28 High-High  Low-High High-High
29  High-Low  High-Low  High-Low
30   Low-Low   Low-Low   Low-Low
31   Low-Low   Low-Low   Low-Low
32  High-Low  High-Low  High-Low
33  High-Low  High-Low  High-Low
34  Low-High  Low-High  Low-High
35 High-High High-High High-High
36 High-High High-High High-High
37 High-High High-High High-High
38 High-High  Low-High High-High
39   Low-Low   Low-Low   Low-Low
40   Low-Low   Low-Low   Low-Low
41   Low-Low   Low-Low   Low-Low
42 High-High High-High High-High
43 High-High High-High High-High
44 High-High High-High High-High
45 High-High High-High High-High
46 High-High High-High High-High
47 High-High   Low-Low High-High
48   Low-Low   Low-Low   Low-Low
49  High-Low  High-Low  High-Low
50 High-High High-High High-High
51 High-High High-High High-High
52 High-High  Low-High High-High
53 High-High High-High High-High
54  High-Low  High-Low  High-Low
55   Low-Low   Low-Low   Low-Low
56  High-Low  High-Low  High-Low
57 High-High High-High High-High
58 High-High  Low-High High-High
59  Low-High  Low-High  Low-High
60   Low-Low   Low-Low   Low-Low
61   Low-Low   Low-Low   Low-Low
62   Low-Low   Low-Low   Low-Low
63   Low-Low   Low-Low   Low-Low
64   Low-Low   Low-Low   Low-Low
65  High-Low  High-Low  High-Low
66   Low-Low   Low-Low   Low-Low
67   Low-Low   Low-Low   Low-Low
68   Low-Low   Low-Low   Low-Low</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>localI.oi1[localI.oi1[,<span class="dv">5</span>]<span class="sc">&lt;</span><span class="fl">0.05</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii        E.Ii     Var.Ii      Z.Ii Pr(z != E(Ii))
34 -12.611814 -0.35173055  20.440912 -2.711710    0.006693708
36   8.324518 -0.16293135   9.702537  2.724799    0.006434058
42   3.876326 -0.06265339   3.778739  2.026330    0.042730963
44   6.743324 -0.10691401   6.412220  2.705213    0.006826060
49  -7.745156 -0.16293135   9.702537 -2.434187    0.014925274
62   7.898812 -0.13181060   7.880471  2.860705    0.004226997
63  24.379711 -2.52741658 105.098428  2.624637    0.008674141
67  10.571781 -0.26666718  15.669793  2.738013    0.006181165
68   7.898812 -0.13181060   7.880471  2.860705    0.004226997</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co">#There are more significant values for the birds</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co">#With inverse distance</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>localI.oi1<span class="ot">=</span><span class="fu">localmoran</span>(div35[,<span class="dv">2</span>], invd.weights)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>?localmoran</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>localI.oi1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Ii          E.Ii       Var.Ii         Z.Ii Pr(z != E(Ii))
1  -9.808124e-05 -5.405897e-06 2.540841e-08 -0.581400615   5.609705e-01
2   7.307599e-06 -1.472730e-07 9.032237e-10  0.248051867   8.040943e-01
3  -2.810989e-06 -3.800588e-06 2.307916e-08  0.006514018   9.948026e-01
4  -1.085793e-05 -2.903285e-06 1.767340e-08 -0.059835711   9.522865e-01
5  -1.729350e-05 -9.845974e-06 5.463545e-08 -0.031862110   9.745820e-01
6   2.864836e-05 -2.673903e-06 1.515846e-08  0.254404963   7.991827e-01
7  -2.827084e-05 -1.472734e-07 9.032279e-10 -0.935775786   3.493886e-01
8  -3.012427e-06 -1.908660e-08 1.170985e-10 -0.276618045   7.820734e-01
9  -1.211676e-06 -7.096197e-07 3.957084e-09 -0.007981142   9.936320e-01
10 -1.252264e-04 -3.800592e-06 2.307921e-08 -0.799283167   4.241262e-01
11  1.062133e-04 -5.345703e-06 3.423476e-08  0.602935626   5.465515e-01
12  2.527150e-05 -4.701166e-07 3.047898e-09  0.466268017   6.410237e-01
13  1.064689e-05 -1.589090e-07 1.031054e-09  0.336524029   7.364757e-01
14  4.348244e-05 -8.202525e-07 5.021464e-09  0.625194153   5.318436e-01
15 -6.478429e-06 -1.500430e-08 7.545923e-11 -0.744057476   4.568417e-01
16 -1.226518e-06 -2.059460e-08 1.336708e-10 -0.104304126   9.169280e-01
17  2.111920e-04 -5.345702e-06 3.423475e-08  1.170307388   2.418773e-01
18  3.149780e-05 -4.701169e-07 3.047902e-09  0.579046943   5.625575e-01
19 -6.812320e-05 -2.199048e-06 1.419535e-08 -0.553313771   5.800486e-01
20 -2.087218e-04 -5.345698e-06 3.423471e-08 -1.099174409   2.716920e-01
21 -7.510704e-05 -2.581663e-05 1.473653e-07 -0.128399955   8.978325e-01
22  6.522670e-05 -1.472732e-07 9.032257e-10  2.175237652   2.961231e-02
23  2.614028e-05 -2.199048e-06 1.419535e-08  0.237857250   8.119918e-01
24 -2.389723e-05 -5.625367e-06 3.161253e-08 -0.102766883   9.181480e-01
25  6.557757e-07 -1.507475e-06 9.748010e-09  0.021910329   9.825195e-01
26  3.371663e-04 -5.345701e-06 3.423474e-08  1.851152595   6.414760e-02
27  1.232998e-04 -1.507475e-06 9.748013e-09  1.264100900   2.061938e-01
28  9.198937e-06 -2.059462e-08 1.336710e-10  0.797425792   4.252038e-01
29  8.521788e-05 -5.345700e-06 3.423473e-08  0.489463306   6.245137e-01
30  4.684646e-05 -1.589089e-07 1.031053e-09  1.463884920   1.432254e-01
31 -2.989662e-05 -9.668027e-06 6.123752e-08 -0.081744204   9.348501e-01
32 -2.240706e-04 -3.132668e-06 2.017461e-08 -1.555491548   1.198290e-01
33 -5.085219e-05 -4.012694e-07 2.290072e-09 -1.054252242   2.917674e-01
34 -7.257953e-04 -1.758653e-05 1.091337e-07 -2.143788470   3.204984e-02
35  2.882244e-04 -1.551180e-05 9.678110e-08  0.976340580   3.288957e-01
36  4.421444e-04 -8.146567e-06 5.180167e-08  1.978433151   4.787986e-02
37  1.616712e-04 -3.132671e-06 2.017465e-08  1.160284543   2.459330e-01
38  1.050212e-05 -2.059461e-08 1.336709e-10  0.910142100   3.627476e-01
39  8.040522e-06 -8.850594e-07 5.732126e-09  0.117890452   9.061545e-01
40  6.132615e-05 -1.589090e-07 1.031053e-09  1.914824438   5.551490e-02
41 -1.943095e-04 -1.235704e-05 7.328858e-08 -0.672109186   5.015142e-01
42  7.925463e-05 -2.903283e-06 1.767337e-08  0.618001778   5.365742e-01
43  5.878111e-04 -1.153526e-05 7.271505e-08  2.222622489   2.624127e-02
44  3.371663e-04 -5.345702e-06 3.423476e-08  1.851152516   6.414761e-02
45  2.321879e-04 -5.345704e-06 3.423478e-08  1.283782237   1.992182e-01
46  8.985150e-05 -1.507475e-06 9.748015e-09  0.925322496   3.547982e-01
47 -3.832887e-06 -2.059461e-08 1.336709e-10 -0.329737073   7.415986e-01
48 -1.085218e-04 -2.199047e-06 1.419534e-08 -0.892386962   3.721856e-01
49 -1.991094e-04 -6.953530e-06 3.892181e-08 -0.973995793   3.300586e-01
50  5.592035e-05 -4.356932e-07 2.670024e-09  1.090643627   2.754297e-01
51  1.692004e-04 -5.345700e-06 3.423474e-08  0.943358185   3.454977e-01
52  1.180529e-05 -2.059462e-08 1.336709e-10  1.022857716   3.063751e-01
53  1.904517e-05 -4.701166e-07 3.047898e-09  0.353488020   7.237226e-01
54  3.309061e-05 -3.132671e-06 2.017465e-08  0.255026232   7.987028e-01
55 -7.452908e-06 -1.589092e-07 1.031057e-09 -0.227156114   8.203024e-01
56 -4.428675e-04 -2.903289e-06 1.767345e-08 -3.309457115   9.347708e-04
57  3.846216e-05 -3.769281e-07 2.104067e-09  0.846718914   3.971518e-01
58  7.413021e-06 -1.908661e-08 1.170985e-10  0.686809530   4.922028e-01
59  2.150674e-05 -1.589090e-07 1.031053e-09  0.674731652   4.998463e-01
60 -7.130883e-05 -6.590525e-06 4.207363e-08 -0.315516559   7.523695e-01
61  4.684639e-05 -1.589090e-07 1.031054e-09  1.463882049   1.432262e-01
62  6.746909e-04 -6.590539e-06 4.207381e-08  3.321395754   8.956843e-04
63  1.119689e-03 -1.171176e-04 4.915527e-07  1.764074499   7.771944e-02
64  5.397255e-06 -7.554456e-07 4.306902e-09  0.093752602   9.253057e-01
65 -2.206088e-04 -2.903283e-06 1.767337e-08 -1.637607130   1.015037e-01
66  2.504894e-04 -1.235703e-05 7.328845e-08  0.970921935   3.315872e-01
67  5.546073e-04 -1.235706e-05 7.328882e-08  2.094290519   3.623411e-02
68  7.969751e-04 -5.284144e-06 2.904507e-08  4.707372008   2.509307e-06
attr(,"call")
localmoran(x = div35[, 2], listw = invd.weights)
attr(,"class")
[1] "localmoran" "matrix"     "array"     
attr(,"quadr")
        mean    median     pysal
1   High-Low  High-Low  High-Low
2    Low-Low   Low-Low   Low-Low
3    Low-Low   Low-Low  Low-High
4   High-Low  High-Low  High-Low
5   High-Low  High-Low  High-Low
6   High-Low  High-Low High-High
7   Low-High  Low-High  Low-High
8   High-Low   Low-Low  High-Low
9    Low-Low   Low-Low  Low-High
10  Low-High   Low-Low  Low-High
11 High-High High-High High-High
12 High-High High-High High-High
13  Low-High  Low-High   Low-Low
14   Low-Low   Low-Low   Low-Low
15  High-Low   Low-Low  High-Low
16 High-High  Low-High  High-Low
17 High-High High-High High-High
18 High-High High-High High-High
19  Low-High  Low-High  Low-High
20  High-Low  High-Low  High-Low
21   Low-Low   Low-Low  Low-High
22   Low-Low   Low-Low   Low-Low
23  Low-High  Low-High   Low-Low
24   Low-Low   Low-Low  Low-High
25 High-High High-High High-High
26 High-High High-High High-High
27 High-High High-High High-High
28 High-High  Low-High High-High
29 High-High High-High High-High
30   Low-Low   Low-Low   Low-Low
31  Low-High  Low-High  Low-High
32  High-Low  High-Low  High-Low
33  High-Low  High-Low  High-Low
34  Low-High  Low-High  Low-High
35 High-High High-High High-High
36 High-High High-High High-High
37 High-High High-High High-High
38 High-High  Low-High High-High
39  Low-High  Low-High   Low-Low
40   Low-Low   Low-Low   Low-Low
41  Low-High   Low-Low  Low-High
42 High-High  High-Low High-High
43 High-High High-High High-High
44 High-High High-High High-High
45 High-High High-High High-High
46 High-High High-High High-High
47 High-High  Low-High  High-Low
48  Low-High  Low-High  Low-High
49  High-Low  High-Low  High-Low
50 High-High High-High High-High
51 High-High High-High High-High
52 High-High  Low-High High-High
53 High-High High-High High-High
54 High-High High-High High-High
55  Low-High  Low-High  Low-High
56  High-Low  High-Low  High-Low
57  High-Low  High-Low High-High
58 High-High   Low-Low High-High
59  Low-High   Low-Low   Low-Low
60  Low-High  Low-High  Low-High
61   Low-Low   Low-Low   Low-Low
62   Low-Low   Low-Low   Low-Low
63   Low-Low   Low-Low   Low-Low
64   Low-Low   Low-Low   Low-Low
65  High-Low  High-Low  High-Low
66   Low-Low   Low-Low   Low-Low
67   Low-Low   Low-Low   Low-Low
68   Low-Low   Low-Low   Low-Low</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>localI.oi1[localI.oi1[,<span class="dv">5</span>]<span class="sc">&lt;</span><span class="fl">0.05</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Ii          E.Ii       Var.Ii      Z.Ii Pr(z != E(Ii))
22  0.0000652267 -1.472732e-07 9.032257e-10  2.175238   2.961231e-02
34 -0.0007257953 -1.758653e-05 1.091337e-07 -2.143788   3.204984e-02
36  0.0004421444 -8.146567e-06 5.180167e-08  1.978433   4.787986e-02
43  0.0005878111 -1.153526e-05 7.271505e-08  2.222622   2.624127e-02
56 -0.0004428675 -2.903289e-06 1.767345e-08 -3.309457   9.347708e-04
62  0.0006746909 -6.590539e-06 4.207381e-08  3.321396   8.956843e-04
67  0.0005546073 -1.235706e-05 7.328882e-08  2.094291   3.623411e-02
68  0.0007969751 -5.284144e-06 2.904507e-08  4.707372   2.509307e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We can also represent the Local Index value using this code lines:</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mfrow=c(2,1))</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># s.value(xy,localI.pp1[,1], ylim=c(min(div35[,4])-10000,max(div35[,4])+10000), xlim=c(min(div35[,3])-10000,max(div35[,3])+10000), sub="local I (plant)")</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># s.value(xy,localI.oi1[,1], ylim=c(min(div35[,4])-10000,max(div35[,4])+10000), xlim=c(min(div35[,3])-10000,max(div35[,3])+10000), sub="local I (bird)")</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Clusters of values that look alike and outliers (values that don't look alike)</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Sometimes close values are similar, sometimes not</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="spatio-temporal-indices" class="level3">
<h3 class="anchored" data-anchor-id="spatio-temporal-indices"><strong>2.3 Spatio-temporal indices</strong></h3>
<p>It is not unusual for a geolocalised database to have observations raised at different points in time. It may be interesting to understand how a localised phenomenon has spread and evolved in space and time and how it can be linked to the conditions of the environment surrounding it. In this case, it is important to be able to assess how the underlying spatial structures change over different periods of time. On spatiotemporal data, prior graphical exploration of cross-section data (standard Moran’s I) can be used to study the existence and change in grouping or dispersion trends that are statistically significantly different from random models. Many recent developments show a growing interest in analysing spatio-temporal data in many areas of research such as physics, meteorology, economics and environmental studies. By extending the Moran index to include time attributes, it becomes possible to calculate global and localized indices that concurrently take into account spatial and temporal auto-correlations. This can also be done on the basis of spatial-temporal risk weighting matrices.</p>
</section>
</section>
<section id="spatial-modeling" class="level2">
<h2 class="anchored" data-anchor-id="spatial-modeling">3 - Spatial modeling</h2>
<p>Once the structure of the spatial correlation has be estimated, it can then be included in the model.</p>
<p>Depending on the structure of the autocorrelation and especially if the process is or is not stationary,and of the structure of the residuals, the analysis required will be different and more or less difficult.</p>
<p>For the analysis under R, it will be important to import the package <strong>spatialreg</strong>, <strong>spdep</strong> as well as <strong>gwrr</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gwrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="stationary-process-1" class="level3">
<h3 class="anchored" data-anchor-id="stationary-process-1">3.1.Stationary process</h3>
<p>For the models described here, it is required for the processes to be stationary, meaning that the process is constant across regions. Another assumption is that the spatial autocorrelation is isotropic. This means that the cause of the autocorrelation act the same way in every direction. Anisotropy may be caused for example by environmental factors like the wind or water currents.</p>
<p>All the models showed here will be based on the general linear model modified to take the spatial autocorrelation into account :</p>
<p><strong>Y = X</strong><span class="math inline">\(\beta\)</span> + <span class="math inline">\(\epsilon\)</span></p>
<section id="spatially-lagged-x-model" class="level4">
<h4 class="anchored" data-anchor-id="spatially-lagged-x-model">3.1.1. Spatially lagged X model</h4>
<section id="theory" class="level5">
<h5 class="anchored" data-anchor-id="theory">Theory</h5>
<p>This analysis best perform on local analysis. If the scale is to big, it may be wiser to use another analysis as this one will lack precision.</p>
<p>The idea behind this analysis is that the state of a neighbor region will affect our region.</p>
<p>This model estimate how well the response variable at one site reflect the response values at its surrounding sites.</p>
<p>An extra parameter : WX<span class="math inline">\(\theta\)</span>, called the autocovariate is added to the general linear model’s formula. It is a distance-weighted function of the neighboring response value.</p>
<p><strong>Y = X</strong><span class="math inline">\(\beta\)</span> + <strong>WX</strong><span class="math inline">\(\theta\)</span> + <span class="math inline">\(\epsilon\)</span></p>
<p>The argument WX<span class="math inline">\(\theta\)</span> is the average of the neighboring Xs.</p>
</section>
<section id="application-in-r" class="level5">
<h5 class="anchored" data-anchor-id="application-in-r">Application in R</h5>
<p><em>(For the purpose of the example, we will assume that the analysis is the right one even though other would be more fitted)</em></p>
<p>As this analysis is quite simple the average value of the neighboring regions can be calculated by hand and then added to the general linear formula.</p>
<p>However, there are commands in R in the package sdpep that allows to do the same analysis ans to go a little further, as well as giving the R-squared value and the p value.</p>
<p>Our exemple here will be the study of plants and bird richness in Ile &amp; Vilaine.</p>
<p><em>(The dataset “div35” set can be found in the doc called “Spatial autocorrelation_ modelisation”)</em></p>
<p><em>(To see how to create weighted matrix, see the previous parts)</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>div35 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"div35.txt"</span>, <span class="at">header=</span>T, <span class="at">dec=</span><span class="st">","</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>xy<span class="ot">=</span>div35[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="co">#Extract the coordinates x and y of each points</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(div35[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="co">#For a rook connection</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>div.knear4<span class="ot">&lt;-</span><span class="fu">knearneigh</span>(<span class="fu">as.matrix</span>(xy),<span class="dv">4</span>) <span class="co">#extract the neighbour points</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="fu">knn2nb</span>(div.knear4) <span class="co"># convert the object of type knn into a type nb # transformation to get as many lists than points/observation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 68 
Number of nonzero links: 272 
Percentage nonzero weights: 5.882353 
Average number of links: 4 
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">knn2nb</span>(div.knear4), xy, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co">#For a Queen conection</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>div.knear8<span class="ot">&lt;-</span><span class="fu">knearneigh</span>(<span class="fu">as.matrix</span>(xy),<span class="dv">8</span>)</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="fu">knn2nb</span>(div.knear8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 68 
Number of nonzero links: 544 
Percentage nonzero weights: 11.76471 
Average number of links: 8 
Non-symmetric neighbours list</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">knn2nb</span>(div.knear8), xy, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spatial weighted matrix</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>pond4.stan<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear4), <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>pond8.stan<span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(div.knear8), <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="co">#The argument "style = "w"" allows to determine the weight given to each link. </span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="co"># "W" for standardized = 1/nb of connections</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co">#if you want to give the same weight to each link, then use the argument "B" instead of "w".</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>(to be able to use the weighted matrix in the analysis, the items must be a class “listw”, hence the argument “nb2listw”)</em></p>
<p>The function used for spatially weighted matrix is “lmslx”. In the argument :</p>
<ul>
<li><p>First the equation tested in shape of : Y ~ X1+X2+X3 …</p></li>
<li><p>the data set (here div35)</p></li>
<li><p>The weighted matrix ( here pond8.stan)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>lmsSLX<span class="ot">=</span>spatialreg<span class="sc">::</span><span class="fu">lmSLX</span>(rich_ois<span class="sc">~</span>rich_pp,<span class="at">data=</span>div35,pond8.stan)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmsSLX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula(paste("y ~ ", paste(colnames(x)[-1], collapse = "+"))), 
    data = as.data.frame(x), weights = weights)

Residuals:
     Min       1Q   Median       3Q      Max 
-15.8936  -1.6548   0.5529   2.1413   6.5077 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  -7.4084    10.8417  -0.683   0.4968  
rich_pp       0.4686     0.1856   2.525   0.0140 *
lag.rich_pp   1.1986     0.4717   2.541   0.0135 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.02 on 65 degrees of freedom
Multiple R-squared:  0.2395,    Adjusted R-squared:  0.2161 
F-statistic: 10.23 on 2 and 65 DF,  p-value: 0.000137</code></pre>
</div>
</div>
<p>Here, 2 coefficients are given as well as their p-value. The first one (rich_pp) correspond to the argument X<span class="math inline">\(\beta\)</span> of our original function. The second one (lag.rich_pp) correspond to WX<span class="math inline">\(\theta\)</span>.</p>
<p><em>Here there is only one X, and therefore only 2 coefficients, but with a bigger model to test, the coefficients corresponding to the X will be named just like the original Xs, and the coefficients for the autocorrelation will be named “lag.X”.</em></p>
<p>As always, we only keep the coefficients that have a significant p-value. Here they all do. Our final model here would be :</p>
<p><span class="math inline">\(Bird\:Richness = -7.40 + 0.47X + 1.19WY + \epsilon\)</span></p>
<p>An interpretation of those results here is that the more plants there is in a place, the more bird will be present as well. As for the lag value, we can expect that the more plants there will in the neighboring regions, the more birds there will in our region.</p>
<p><em>This model works at small scale only</em></p>
<p>The first estimate, that regards the response variable is called the <strong>direct effect</strong>, wherease the factor impacting the autocorrelation is called the <strong>indirect factor</strong>. However we can have an idea of the general effect on the whole region by combining the two effects int the <strong>total effect</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">impacts</span>(lmsSLX)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SlX, glht):
           Direct Indirect    Total
rich_pp 0.4685765 1.198607 1.667184</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">impacts</span>(lmsSLX, <span class="at">R=</span><span class="dv">500</span>),<span class="at">zstats=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impact measures (SlX, glht, n-k):
           Direct Indirect    Total
rich_pp 0.4685765 1.198607 1.667184
========================================================
Standard errors:
           Direct  Indirect     Total
rich_pp 0.1856093 0.4717312 0.4377709
========================================================
Z-values:
          Direct Indirect    Total
rich_pp 2.524532 2.540869 3.808348

p-values:
        Direct   Indirect Total    
rich_pp 0.011585 0.011058 0.0001399</code></pre>
</div>
</div>
<p>The function impact only gives the total effect as the sum of the direct and indirect effect. Putting the function into a summary allows to show standard error, and the p-values. The total effect represent the overall impact of the variable when applied to the whole map.</p>
<p><em>Sometimes, non-significant direct and indirect effect may become significant when looking at the total effect</em></p>
</section>
</section>
<section id="simultaneous-autoregressive-models-sar" class="level4">
<h4 class="anchored" data-anchor-id="simultaneous-autoregressive-models-sar">3.1.2. - Simultaneous autoregressive models (SAR)</h4>
<p>To be able to study an autocorrelation at a larger scale, other models must be used.</p>
<p>The SAR model is an autoregressive model.These models take spatial autocorrelation into account by using a neighborhood matrix specifying the relationship between the residuals at each location.</p>
<p>The SAR model allows to study directional processes, which, in ecology, are quite common ( ex : wind dispersal or stream flows). The null hypothesis for the general SAR model is that the Ys are mutually independent.</p>
<p>The autoregressif process can be found in either the residuals of the data or in the response value. Depending on where this process is thought to be,three models are available :</p>
<ul>
<li>The <strong>Error model</strong></li>
<li>The <strong>Lag model</strong></li>
<li>The <strong>Mix model</strong></li>
</ul>
<p>A specific diagnostic can be made to chose between either one.</p>
<section id="lagrange-multiplier-diagnostic" class="level5">
<h5 class="anchored" data-anchor-id="lagrange-multiplier-diagnostic">3.1.2.1. Lagrange Multiplier diagnostic</h5>
<section id="theory-1" class="level6">
<h6 class="anchored" data-anchor-id="theory-1"><strong>Theory</strong></h6>
<p>The idea for this test is to statistically check which of the SAR model would best fit to our equation.</p>
<p>The Lagrange multiplier diagnostic tests the fit of the model under the null hypothesis and looks for evidence of departures in the direction of interest. In summary, it will examine the residuals of a model and look for specific types of non-randomness.</p>
</section>
<section id="application-in-r-1" class="level6">
<h6 class="anchored" data-anchor-id="application-in-r-1"><strong>Application in R</strong></h6>
<p>The command lm.LMtests() allows to get the lagrange multiplier for a set model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>lmO<span class="ot">=</span><span class="fu">lm</span>(div35<span class="sc">$</span>rich_ois<span class="sc">~</span>div35<span class="sc">$</span>rich_pp)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.LMtests</span>(lmO,pond8.stan, <span class="at">test=</span><span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = div35$rich_ois ~ div35$rich_pp)
weights: pond8.stan

LMerr = 1.7447, df = 1, p-value = 0.1865


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = div35$rich_ois ~ div35$rich_pp)
weights: pond8.stan

LMlag = 4.1598, df = 1, p-value = 0.04139


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = div35$rich_ois ~ div35$rich_pp)
weights: pond8.stan

RLMerr = 3.7287, df = 1, p-value = 0.05349


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = div35$rich_ois ~ div35$rich_pp)
weights: pond8.stan

RLMlag = 6.1438, df = 1, p-value = 0.01319


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = div35$rich_ois ~ div35$rich_pp)
weights: pond8.stan

SARMA = 7.8884, df = 2, p-value = 0.01937</code></pre>
</div>
</div>
<p>The arguments are :</p>
<ul>
<li><p>The dataset (here lm0)</p></li>
<li><p>The weight matrix (here pond8.stan)</p></li>
<li><p>test = the type of test that will be made (here, “all” means that the fives tests will be conducted : LMerr, LMlag, RLMerr, RLMlag, SARMA)</p></li>
</ul>
<p>The firsts p-values to look at are for the normal tests. The significant one will be the analysis conducted later. If non of them are significant, we look at the robust tests.</p>
</section>
</section>
<section id="lag-models" class="level5">
<h5 class="anchored" data-anchor-id="lag-models">3.1.2.2. Lag models</h5>
<section id="theory-2" class="level6">
<h6 class="anchored" data-anchor-id="theory-2">Theory</h6>
<p>In this model, we assume that the autoregressif process is in the response variable. As this model is general, this means that anything affecting our Y, will also affect its neighbor in some way, affecting us in return. This creates a feedback effect.</p>
<p>It would for exemple be liked a stone thrown in a lake. This creates waves that propagate to the whole lake.</p>
<p>The lag model is used to take into account a autoregressif process only occuring in the response variable. Therefore, the responsable variable argument in the model will include a term for the spatial autocorrelation : <strong>ρW</strong></p>
<p>The model will take the form of :</p>
<p><strong>Y =</strong><span class="math inline">\(\rho\)</span><strong>Wx +X</strong><span class="math inline">\(\beta\)</span> + <span class="math inline">\(\epsilon\)</span></p>
<p><strong>ρ</strong> is the autoregression parameter <strong>W</strong> is the spatial weights matrix</p>
</section>
<section id="application-in-r-2" class="level6">
<h6 class="anchored" data-anchor-id="application-in-r-2">Application in R</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lagsarlm</span>(rich_ois<span class="sc">~</span>rich_pp, div35, pond8.stan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lagsarlm(formula = rich_ois ~ rich_pp, data = div35, listw = pond8.stan)
Type: lag 

Coefficients:
        rho (Intercept)     rich_pp 
  0.3733486   8.2046960   0.5261261 

Log likelihood: -191.0906 </code></pre>
</div>
</div>
<p>Using the values obtained here, the final model would be:</p>
<p><span class="math inline">\(Bird\:Richness = 0.37\:WX +0.53\:X + \epsilon\)</span></p>
</section>
</section>
<section id="error-models" class="level5">
<h5 class="anchored" data-anchor-id="error-models">3.1.2.3. Error models</h5>
<section id="theory-3" class="level6">
<h6 class="anchored" data-anchor-id="theory-3">Theory</h6>
<p>When using the error model, we assume that the autoregressif process is only in the residuals.</p>
<p>When dealing with such model, an interpretation may be that some spatially correlated variable are missing in the dataset.</p>
<p>this model takes the form of :</p>
<p><strong>Y = X</strong><span class="math inline">\(\beta\)</span> + <span class="math inline">\(\lambda\)</span><strong>WY</strong> + <span class="math inline">\(\epsilon\)</span></p>
<p>The term <span class="math inline">\(\lambda\)</span>W represent the spatial structure with <span class="math inline">\(\lambda\)</span> being the spatial autoregression coefiscient. <span class="math inline">\(\gamma\)</span> is the spatially dependant error term.</p>
</section>
<section id="application-in-r-3" class="level6">
<h6 class="anchored" data-anchor-id="application-in-r-3">Application in R</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">errorsarlm</span>(rich_ois<span class="sc">~</span>rich_pp, <span class="at">data =</span> div35, pond8.stan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
errorsarlm(formula = rich_ois ~ rich_pp, data = div35, listw = pond8.stan)
Type: error 

Coefficients:
     lambda (Intercept)     rich_pp 
  0.3331847  21.0332219   0.5184891 

Log likelihood: -191.8431 </code></pre>
</div>
</div>
<p>Using the values obtained here, the final model would be:</p>
<p><span class="math inline">\(Bird\:Richness =0.52\:X + 0.33\:WY + \epsilon\)</span></p>
</section>
</section>
<section id="mixed-models" class="level5">
<h5 class="anchored" data-anchor-id="mixed-models">3.1.2.4. Mixed models</h5>
<section id="theory-4" class="level6">
<h6 class="anchored" data-anchor-id="theory-4">Theory</h6>
<p>If the spatial autocorrelation affect both the response variable and the residuals, the mix model is used. This model include all the parameter added above, and it is the most inclusive model.</p>
<p>It can be noted that this model can also be used in both situation described previously, as the coefficient will cancel themselves out if either one is not present.</p>
<p><strong>Y =</strong> <span class="math inline">\(\rho\)</span><strong>WX +X</strong><span class="math inline">\(\beta\)</span> + <span class="math inline">\(\lambda\)</span><strong>WY</strong> + <span class="math inline">\(\epsilon\)</span></p>
</section>
<section id="application-in-r-4" class="level6">
<h6 class="anchored" data-anchor-id="application-in-r-4">Application in R</h6>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>lmsarD<span class="ot">=</span>spatialreg<span class="sc">::</span><span class="fu">sacsarlm</span>(rich_ois<span class="sc">~</span>rich_pp,<span class="at">data=</span>div35,pond8.stan)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmsarD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:spatialreg::sacsarlm(formula = rich_ois ~ rich_pp, data = div35, 
    listw = pond8.stan)

Residuals:
      Min        1Q    Median        3Q       Max 
-15.48701  -1.58517   0.52216   2.42819   6.27633 

Type: sac 
Coefficients: (asymptotic standard errors) 
            Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept) -1.07853    6.34383 -0.1700 0.8650009
rich_pp      0.53751    0.16269  3.3038 0.0009539

Rho: 0.63823
Asymptotic standard error: 0.20901
    z-value: 3.0535, p-value: 0.0022618
Lambda: -0.65643
Asymptotic standard error: 0.50258
    z-value: -1.3061, p-value: 0.19151

LR test value: 4.7419, p-value: 0.093391

Log likelihood: -190.4117 for sac model
ML residual variance (sigma squared): 14.311, (sigma: 3.783)
Number of observations: 68 
Number of parameters estimated: 5 
AIC: NA (not available for weighted model), (AIC for lm: 391.57)</code></pre>
</div>
</div>
<p>From here, we can replace in the formula :</p>
<p><span class="math inline">\(Bird\:Richness = 0.64WX + 0.53X - 0.65\)</span></p>
<p><em>For exemple purpose, the lambda was implemented in the model. However it was not necessary here as the associated value was not significant</em></p>
<p>Even though three commands are available for each type of SAR model, it is best to only use the mixed model function sacsarlm, as the other ones don’t provide p-values, and this one provides more information than the others.</p>
<p><img src="Spatial autocorrelation_ modelisation\SAR_function_summary.png" class="img-fluid"></p>
<p><em>(If the image doesn’t load, it is available in the Spatial autocorrelation_ modelisation doc)</em></p>
</section>
</section>
</section>
</section>
<section id="non-stationary-process-1" class="level3">
<h3 class="anchored" data-anchor-id="non-stationary-process-1">3.2. - Non stationary process</h3>
<p><strong>Graphically weighted models (GWM)</strong></p>
<section id="theory-5" class="level6">
<h6 class="anchored" data-anchor-id="theory-5">Theory</h6>
<p>In ecology, a lot of processes are non stationary. This model is one of the few that allow to deal with non-stationarity. It is a local modeling.</p>
<p>The model is fitted to be locally linear :</p>
<p><span class="math display">\[Y_i = \beta_{0i}\:+\:\sum_k\beta_{ki}x_{ki}\:+\epsilon_i\]</span></p>
<p>The <span class="math inline">\(\beta\)</span> here now correspond to the coefficient at the location i.</p>
<p>It applies a geographical weight to the data used in each model, meaning that the further away a point will be from the regression point, the less weight they will have. This model require the use of a function called the <strong>Kernel function</strong>. It consists in an equation giving the weights <span class="math inline">\(w_ij\)</span> relating the focal point <span class="math inline">\(i\)</span> to each observation <span class="math inline">\(j\)</span>. This means it places a “window” over the observation.</p>
<p>To define the “window” or <strong>bandwidth</strong>, a local regression is made with a set bandwidth and then used to predict the values of the dependant variables. The residuals obtained are compared to other residuals from other regressions made with different bandwidth and the smallest local residuals are kept.</p>
<p>Once the bandwidth is defined, the regression is made for each points and the result can be mapped.</p>
</section>
<section id="application-in-r-5" class="level6">
<h6 class="anchored" data-anchor-id="application-in-r-5">Application in R</h6>
<p>The function gwr.est will define the optimal bandwidth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>lmgwrD<span class="ot">=</span><span class="fu">gwr.est</span>(rich_ois<span class="sc">~</span>rich_pp,<span class="at">data=</span>div35,<span class="at">locs=</span>xy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Bandwidth:  79992  RMSPE : 4.216"
[1] "Bandwidth:  60260  RMSPE : 4.175"
[1] "Bandwidth:  45461  RMSPE : 4.126"
[1] "Bandwidth:  34361  RMSPE : 4.07"
[1] "Bandwidth:  26037  RMSPE : 4.012"
[1] "Bandwidth:  7306  RMSPE : 3.983"
[1] "Bandwidth:  21354  RMSPE : 3.972"
[1] "Bandwidth:  17842  RMSPE : 3.943"
[1] "Bandwidth:  9940  RMSPE : 3.927"
[1] "Bandwidth:  15867  RMSPE : 3.928"
[1] "Bandwidth:  14385  RMSPE : 3.919"
[1] "Bandwidth:  11052  RMSPE : 3.918"
[1] "Bandwidth:  13552  RMSPE : 3.916"
[1] "Bandwidth:  11677  RMSPE : 3.915"
[1] "Bandwidth:  13083  RMSPE : 3.915"
[1] "Bandwidth:  12028  RMSPE : 3.915"
[1] "Bandwidth:  12819  RMSPE : 3.915"
[1] "Bandwidth:  12226  RMSPE : 3.915"
[1] "Bandwidth:  12671  RMSPE : 3.915"
[1] "Bandwidth:  12337  RMSPE : 3.914"
[1] "Bandwidth:  12588  RMSPE : 3.914"
[1] "Bandwidth:  12525  RMSPE : 3.914"
[1] "Bandwidth:  12384  RMSPE : 3.914"
[1] "Bandwidth:  12490  RMSPE : 3.914"
[1] "Bandwidth:  12411  RMSPE : 3.914"
[1] "Bandwidth:  12470  RMSPE : 3.914"
[1] "Bandwidth:  12425  RMSPE : 3.914"
[1] "Bandwidth:  12437  RMSPE : 3.914"
[1] "Bandwidth:  12462  RMSPE : 3.914"
[1] "Bandwidth:  12443  RMSPE : 3.914"
[1] "Bandwidth:  12457  RMSPE : 3.914"
[1] "Bandwidth:  12453  RMSPE : 3.914"
[1] "Bandwidth:  12445  RMSPE : 3.914"
[1] "Bandwidth:  12447  RMSPE : 3.914"
[1] "Bandwidth:  12452  RMSPE : 3.914"
[1] "Bandwidth:  12449  RMSPE : 3.914"
[1] "Bandwidth:  12451  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12449  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12449  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12449  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"
[1] "Bandwidth:  12450  RMSPE : 3.914"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmgwrD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Length Class  Mode   
phi       1    -none- numeric
RMSPE     1    -none- numeric
beta    136    -none- numeric
yhat     68    -none- numeric
RMSE      1    -none- numeric
rsquare   1    -none- numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The value for each parameters are obtained by directly fetching the parameters from the list :</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>lmgwrD<span class="sc">$</span>phi <span class="co">#gives the bandwidth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12449.71</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>lmgwrD<span class="sc">$</span>RMSPE <span class="co">#gives the root-square of the bandwidth</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.914431</code></pre>
</div>
</div>
<p><strong>Phi</strong>: kernel bandwidth</p>
<p><strong>RMSPE</strong>: root square of error of the prediction based on bandwidth estimated</p>
<p><strong>Beta</strong>: matrix with the coefficients for each point (intercept line [1,] and regression coefficient line [2,])</p>
<p><strong>Yhat</strong>: model estimate</p>
<p><strong>RMSE</strong>: root square of error estimation</p>
<p><strong>Rsquare</strong>: model fitting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xy)</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">s.value</span>(xy,lmgwrD<span class="sc">$</span>beta[<span class="dv">2</span>,],<span class="at">add.plot=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_dependance_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The result can finally be plotted for each point.</p>
</section>
</section>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>F. Dormann, Carsten, Jana M. McPherson, Miguel B. Araújo, Roger Bivand, Janine Bolliger, Gudrun Carl, Richard G. Davies, et al.&nbsp;«&nbsp;Methods to Account for Spatial Autocorrelation in the Analysis of Species Distributional Data: A Review&nbsp;». Ecography 30, nᵒ 5 (2007): 609‑28. https://doi.org/10.1111/j.2007.0906-7590.05171.x.</p>
<p>Smith, P. A. (1994). Autocorrelation in Logistic Regression Modelling of Species’ Distributions. Global Ecology and Biogeography Letters, 4(2), 47–. doi:10.2307/2997753</p>
<p>Getis, Arthur. «Spatial Autocorrelation». In Handbook of Applied Spatial Analysis: Software Tools, Methods and Applications, édité par Manfred M. Fischer et Arthur Getis, 255‑78. Berlin, Heidelberg: Springer, 2010. https://doi.org/10.1007/978-3-642-03647-7_14.</p>
<p>https://www.youtube.com/watch?v =b3HtV2Mhmvk</p>
<p>Engle, Robert F. «&nbsp;A general approach to lagrange multiplier model diagnostics&nbsp;». Journal of Econometrics 20, nᵒ 1 (1 octobre 1982): 83‑104. https://doi.org/10.1016/0304-4076(82)90104-X.</p>
<p>Class and powerpoint made by Mrs.&nbsp;Le Gouar Pascaline</p>
<p>GWR informations : https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-statistics/how-geographicallyweightedregression-works.htm</p>
<p>Páez, A., et D. C. Wheeler. «&nbsp;Geographically Weighted Regression&nbsp;». In International Encyclopedia of Human Geography, édité par Rob Kitchin et Nigel Thrift, 407‑14. Oxford: Elsevier, 2009. https://doi.org/10.1016/B978-008044910-4.00447-8.</p>
<p>https://gdsl-ul.github.io/san/09-gwr.html</p>
<p>Anselin, Luc (2013). Spatial econometrics: methods and models. Vol. 4. Springer Science &amp; Business Media.</p>
<p>Anselin, Luc and Daniel A Griffith (1988). « Do spatial effects really matter in regression analysis? » Papers in Regional Science 65.1, pp.&nbsp;11–34.</p>
<p>Bivand, Roger S, Edzer Pebesma, and Virgilio Gomez-Rubio (2013b). « Spatial Neighbors ». Applied Spatial Data Analysis with R. Springer, pp.&nbsp;83–125.</p>
<p>Toussaint (2014). « The sphere of influence graph: Theory and applications ». International Journal of Information Thechnology and Computer Science 14.2.</p>
<p>Smith, Tony E. (2016). Notebook on Spatial Data Analysis. http://www.seas.upenn.edu/ ese502/notebo</p>
<p>Tiefelsdorf, Michael (1998). « Modelling spatial processes: The identification and analysis of spatial relationships in regression residuals by means of Moran’s I (Germany) ». PhD thesis. Université Wilfrid Laurier.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>